{"version":3,"file":"index.js","sources":["../../../../../../packages/extension/WhichWay/src/updateLog/index.js"],"sourcesContent":["import { createApp } from \"vue\";\r\nimport { whichWayFile } from \"../file.js\";\r\nimport { onContent, onSetDev } from \"../hooks/index.js\";\r\nimport { upDataContentCurrent } from \"./updateContentCurrent.js\";\r\nimport UpdateNotice from \"./updateNotice.vue\";\r\nimport { whichWayVersion } from \"../version.js\";\r\n\r\nclass WhichWayUpdateLog {\r\n    async init(){\r\n        this.updateLog = await whichWayFile.readFile(\"src:updateLog/updateContent.txt\");\r\n\r\n        onContent({\r\n            name: \"WhichWayUpdateLog_showUpdateNotice\",\r\n            fn: () => {\r\n                if(whichWayVersion.extVersionChanged){\r\n                    this.showUpdateNotice();\r\n                }\r\n            }\r\n        })\r\n    }\r\n\r\n\tcurrentLog = upDataContentCurrent;\r\n\r\n    /**\r\n     * @type {string}\r\n     */\r\n\tupdateLog;\r\n\r\n\t/**\r\n\t * 创建更新提示的 DOM 对象\r\n\t * @param {Object} [info] - 更新信息数据\r\n\t * @param {Function} [onClose] - 关闭回调函数\r\n\t * @returns {HTMLElement} 渲染好的 DOM 元素\r\n\t */\r\n\tcreateUpdateNotice(info = this.currentLog,onClose = () => {}) {\r\n\t\tconst container = document.createElement(\"div\");\r\n\t\tcontainer.className = \"update-notice-wrapper\";\r\n\r\n\t\tconst app = createApp(UpdateNotice, {\r\n\t\t\tinfo,\r\n\t\t\tonClose: () => {\r\n                if(typeof onClose === \"function\") onClose();\r\n\t\t\t\tapp.unmount();\r\n\t\t\t\tif (container.parentNode) {\r\n\t\t\t\t\tcontainer.parentNode.removeChild(container);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tapp.mount(container);\r\n\r\n        //@ts-ignore\r\n\t\treturn container.firstElementChild;\r\n\t}\r\n\r\n\t/**\r\n\t * 快速显示更新提示（自动添加到 body）\r\n\t * @param {Object} [info] - 更新信息数据\r\n\t * @param {Function} [onClose] - 关闭回调\r\n\t * @returns {Object} { dom, close } - DOM 元素和关闭方法\r\n\t */\r\n\tshowUpdateNotice(info = this.currentLog, onClose = () => {}) {\r\n\t\tconst dom = this.createUpdateNotice(info, close);\r\n\r\n\t\tconst overlay = document.createElement(\"div\");\r\n        overlay.classList.add(\"whichWayUpdateNoticeOverlay\");\r\n\t\toverlay.style.cssText = `\r\n            position: fixed;\r\n            top: 0;\r\n            left: 0;\r\n            right: 0;\r\n            bottom: 0;\r\n            background: rgba(0, 0, 0, 0.6);\r\n            display: flex;\r\n            justify-content: center;\r\n            align-items: center;\r\n            z-index: 9999;\r\n            transition: opacity 0.3s;\r\n        `;\r\n\r\n\t\toverlay.appendChild(dom);\r\n\t\tdocument.body.appendChild(overlay);\r\n\r\n        function close(overlay = document.querySelector(\".whichWayUpdateNoticeOverlay\")){\r\n            if(!overlay){\r\n                throw new Error(\"未找到更新提示的遮罩层\");\r\n            }\r\n            //@ts-ignore\r\n            overlay.style.opacity = \"0\";\r\n\t\t\tsetTimeout(() => {\r\n                //@ts-ignore\r\n\t\t\t\tif (overlay.parentNode) {\r\n                    //@ts-ignore\r\n\t\t\t\t\tdocument.body.removeChild(overlay);\r\n\t\t\t\t}\r\n\t\t\t\tonClose();\r\n\t\t\t}, 300);\r\n        }\r\n\r\n\t\toverlay.addEventListener(\"click\", e => {\r\n\t\t\tif (e.target === overlay) {\r\n\t\t\t\tclose();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn { dom, close, overlay };\r\n\t}\r\n}\r\n\r\nexport const whichWayUpdateLog = new WhichWayUpdateLog();\r\n\r\nawait whichWayUpdateLog.init();\r\n\r\nonSetDev({\r\n\tname: \"WhichWayUpdateLog_setDev\",\r\n\tfn: () => {\r\n\t\t//@ts-ignore\r\n\t\twindow.whichWayUpdateLog = whichWayUpdateLog;\r\n\t},\r\n});\r\n\r\nwindow.whichWay.register(\"updateLog\", whichWayUpdateLog);\r\n"],"names":["overlay"],"mappings":";;;;;;AAOA,MAAM,kBAAkB;AAAA,EACpB,MAAM,OAAM;AACR,SAAK,YAAY,MAAM,aAAa,SAAS,iCAAiC;AAE9E,cAAU;AAAA,MACN,MAAM;AAAA,MACN,IAAI,MAAM;AACN,YAAG,gBAAgB,mBAAkB;AACjC,eAAK,iBAAgB;AAAA,QACzB;AAAA,MACJ;AAAA,IACZ,CAAS;AAAA,EACL;AAAA,EAEH,aAAa;AAAA;AAAA;AAAA;AAAA,EAKb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,mBAAmB,OAAO,KAAK,YAAW,UAAU,MAAM;AAAA,EAAC,GAAG;AAC7D,UAAM,YAAY,SAAS,cAAc,KAAK;AAC9C,cAAU,YAAY;AAEtB,UAAM,MAAM,UAAU,cAAc;AAAA,MACnC;AAAA,MACA,SAAS,MAAM;AACF,YAAG,OAAO,YAAY,WAAY;AAC9C,YAAI,QAAO;AACX,YAAI,UAAU,YAAY;AACzB,oBAAU,WAAW,YAAY,SAAS;AAAA,QAC3C;AAAA,MACD;AAAA,IACH,CAAG;AAED,QAAI,MAAM,SAAS;AAGnB,WAAO,UAAU;AAAA,EAClB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,iBAAiB,OAAO,KAAK,YAAY,UAAU,MAAM;AAAA,EAAC,GAAG;AAC5D,UAAM,MAAM,KAAK,mBAAmB,MAAM,KAAK;AAE/C,UAAM,UAAU,SAAS,cAAc,KAAK;AACtC,YAAQ,UAAU,IAAI,6BAA6B;AACzD,YAAQ,MAAM,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAcxB,YAAQ,YAAY,GAAG;AACvB,aAAS,KAAK,YAAY,OAAO;AAE3B,aAAS,MAAMA,WAAU,SAAS,cAAc,8BAA8B,GAAE;AAC5E,UAAG,CAACA,UAAQ;AACR,cAAM,IAAI,MAAM,aAAa;AAAA,MACjC;AAEA,MAAAA,SAAQ,MAAM,UAAU;AACjC,iBAAW,MAAM;AAEhB,YAAIA,SAAQ,YAAY;AAEvB,mBAAS,KAAK,YAAYA,QAAO;AAAA,QAClC;AACA;MACD,GAAG,GAAG;AAAA,IACD;AAEN,YAAQ,iBAAiB,SAAS,OAAK;AACtC,UAAI,EAAE,WAAW,SAAS;AACzB;MACD;AAAA,IACD,CAAC;AAED,WAAO,EAAE,KAAK,OAAO;EACtB;AACD;AAEY,MAAC,oBAAoB,IAAI,kBAAiB;AAEtD,MAAM,kBAAkB,KAAI;AAE5B,SAAS;AAAA,EACR,MAAM;AAAA,EACN,IAAI,MAAM;AAET,WAAO,oBAAoB;AAAA,EAC5B;AACD,CAAC;AAED,OAAO,SAAS,SAAS,aAAa,iBAAiB;"}