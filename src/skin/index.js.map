{"version":3,"file":"index.js","sources":["../../../../../../packages/extension/WhichWay/src/skin/index.ts"],"sourcesContent":["import { createApp } from \"vue\";\r\nimport { lib, game, ui, get, ai, _status } from \"noname\";\r\nimport { whichWayFile } from \"../file.js\";\r\nimport { onArenaReady, onConfig, onContent, onInit, onPrecontent, onSetDev } from \"../hooks/index.js\";\r\nimport { whichWayAPIOverride } from \"../override/index.js\";\r\nimport { whichWayToast } from \"../toast/index.ts\";\r\nimport { whichWayUtil } from \"../utill.js\";\r\nimport { whichWayVersion } from \"../version.js\";\r\nimport { spineWorker } from \"./spineWork.js\";\r\nimport ConfOverride from \"./confOverride.vue\";\r\nimport { confictedSkin } from \"./confictedSkin.ts\";\r\nclass WhichWaySkin {\r\n\t/**\r\n\t * 皮肤组件初始化\r\n\t */\r\n\tasync init() {\r\n\t\tawait whichWayUtil\r\n\t\t\t.measureExecutionTime(async () => {\r\n\t\t\t\tawait this.autoUpdateSkinData();\r\n\t\t\t\tthis.syncAllSkinConfig();\r\n\t\t\t})\r\n\t\t\t.then(({ duration }) => {\r\n\t\t\t\tif (whichWayUtil.isDeveloperMode()) console.log(`[whichWaySkin] init skin time ${duration}ms`);\r\n\t\t\t});\r\n\r\n\t\t// onArenaReady({\r\n\t\t// \tname: \"whichWaySkinInitSkinData_precontent_sort\",\r\n\t\t// \tfn: async () => {\r\n\t\t// \t\tthis.initConfictedSkins();\r\n\t\t// \t\tif(this.confictedSkins.size > 0) await this.showConflictedSkin();\r\n\t\t// \t\tthis.syncAllSkinConfig();\r\n\t\t// \t},\r\n\t\t// });\r\n\r\n\t\tonInit({\r\n\t\t\tname: \"whichWaySkinInitSkinData_init\",\r\n\t\t\tfn: async () => {\r\n\t\t\t\t//为所有角色添加皮肤\"经典形象\"\r\n\t\t\t\tfor (const name of window.whichWaySave.allCharacters) {\r\n\t\t\t\t\tthis.skinData[name] ??= {\r\n\t\t\t\t\t\tname: name,\r\n\t\t\t\t\t\tskins: {},\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\t//为了让经典形象在皮肤列表的最前面\r\n\t\t\t\t\tthis.skinData[name].skins = {\r\n\t\t\t\t\t\t经典形象: {\r\n\t\t\t\t\t\t\tname: \"经典形象.jpg\",\r\n\t\t\t\t\t\t\tpath: whichWayFile.compilePath(`img:character/${name}.jpg`),\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\t...this.skinData[name].skins,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tonContent({\r\n\t\t\tname: \"whichWaySkinAddInitDyc\",\r\n\t\t\tfn() {\r\n\t\t\t\tif (!spineWorker.needEnable()) return;\r\n\t\t\t\tlet mode = whichWayUtil.config(\"WhichWayDynamicSkinSwitch\");\r\n\t\t\t\tif (mode === \"sjzx\") {\r\n\t\t\t\t\twhichWayAPIOverride.appendHook(\"lib.element.player.init\", {\r\n\t\t\t\t\t\tbefore(character, character2) {\r\n\t\t\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t\t\tif (this.dycSJZX) spineWorker.dispose(this.dycSJZX);\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t(function () {\r\n\t\t\t\t\t\t\t\t\tlet mode = lib.config.mode;\r\n\t\t\t\t\t\t\t\t\tswitch (mode) {\r\n\t\t\t\t\t\t\t\t\t\tcase \"single\":\r\n\t\t\t\t\t\t\t\t\t\t\treturn get.config(\"double_character\", mode) !== \"single\";\r\n\t\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\t\treturn get.config(\"double_character\", mode);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})()\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\twhichWayToast.showToast(\"【驶舰之向】:双将时无法使用动皮！\", 5000, \"bottomCenter\", \"sjzx_doubleCharacterWarn\");\r\n\t\t\t\t\t\t\t} else spineWorker.updateDyc(character, this);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\twhichWayAPIOverride.appendHook(\"lib.element.player.reinit\", {\r\n\t\t\t\t\t\tbefore(character, character2) {\r\n\t\t\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t\t\tif (this.dycSJZX) spineWorker.dispose(this.dycSJZX);\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t(function () {\r\n\t\t\t\t\t\t\t\t\tlet mode = lib.config.mode;\r\n\t\t\t\t\t\t\t\t\tswitch (mode) {\r\n\t\t\t\t\t\t\t\t\t\tcase \"single\":\r\n\t\t\t\t\t\t\t\t\t\t\treturn get.config(\"double_character\", mode) !== \"single\";\r\n\t\t\t\t\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\t\t\t\t\treturn get.config(\"double_character\", mode);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})()\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\twhichWayToast.showToast(\"【驶舰之向】:双将时无法使用动皮！\", 5000, \"bottomCenter\", \"sjzx_doubleCharacterWarn\");\r\n\t\t\t\t\t\t\t} else spineWorker.updateDyc(character, this);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (mode === \"piqie\") {\r\n\t\t\t\t\tlet piqieData = { ...lib.config.sjzxDycAssets };\r\n\t\t\t\t\tfor (let charName in piqieData) {\r\n\t\t\t\t\t\tlet char = piqieData[charName];\r\n\t\t\t\t\t\tfor (let skinName in char) {\r\n\t\t\t\t\t\t\tlet skin = char[skinName];\r\n\t\t\t\t\t\t\tif (Array.isArray(skin.action)) skin.action = skin.action[0];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tif (!decadeUI.dynamicSkin) decadeUI.dynamicSkin = {};\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tObject.assign(decadeUI.dynamicSkin, piqieData);\r\n\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tif (!skinSwitch.saveSkinParams) skinSwitch.saveSkinParams = {};\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tObject.assign(skinSwitch.saveSkinParams, piqieData);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tonArenaReady({\r\n\t\t\tname: \"whichWayInitDycDragging\",\r\n\t\t\tfn() {\r\n\t\t\t\t//动皮参数调整\r\n\t\t\t\tif (spineWorker.needEnable() && whichWayUtil.isDeveloperMode()) {\r\n\t\t\t\t\tui.create.system(\r\n\t\t\t\t\t\t\"动皮拖拽\",\r\n\t\t\t\t\t\t() => {\r\n\t\t\t\t\t\t\t//@ts-ignore\r\n\t\t\t\t\t\t\tspineWorker.draggingDyc(game.me.dycSJZX);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\ttrue\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tonConfig({\r\n\t\t\tname: \"whichWaySkinUpdateSkinData_add\",\r\n\t\t\tpriority: 899,\r\n\t\t\tobj: {\r\n\t\t\t\tname: \"updateSkinData\",\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tname: \"<button type=`button`>更新皮肤数据</button>\",\r\n\t\t\t\t\tclear: true,\r\n\t\t\t\t\tasync onclick() {\r\n\t\t\t\t\t\tif (window.whichWaySave.updatingSkinData) {\r\n\t\t\t\t\t\t\twhichWayToast.showToast(\"[驶舰之向] 正在更新皮肤数据，请勿重复操作...\", 3000, \"topLeft\", \"configTips_updateSkinData_updatingSkinData\");\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\twindow.whichWaySave.updatingSkinData = true;\r\n\t\t\t\t\t\twhichWayToast.showToast(\"[驶舰之向] 正在更新皮肤数据...\", true, \"topLeft\", \"configTips_updateSkinData\");\r\n\t\t\t\t\t\tawait whichWaySkin.autoUpdateSkinData(true).then(() => {\r\n\t\t\t\t\t\t\twindow.whichWaySave.updatingSkinData = false;\r\n\t\t\t\t\t\t\twhichWayToast.removeToastById(\"configTips_updateSkinData_updatingSkinData\");\r\n\t\t\t\t\t\t\twhichWayToast.showToast(\"[驶舰之向] 皮肤数据更新完成!\", 3000, \"topLeft\", \"configTips_updateSkinData\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tonConfig({\r\n\t\t\tname: \"WhichWayDynamicSkinSwitch_add\",\r\n\t\t\tpriority: 755,\r\n\t\t\tobj: {\r\n\t\t\t\tname: \"WhichWayDynamicSkinSwitch\",\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tname: \"动皮组件\",\r\n\t\t\t\t\tintro: \"选择动皮组件\",\r\n\t\t\t\t\tinit: \"sjzx\",\r\n\t\t\t\t\titem: {\r\n\t\t\t\t\t\tsjzx: \"驶舰之向\",\r\n\t\t\t\t\t\tpiqie: \"皮肤切换\",\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tonConfig({\r\n\t\t\tname: \"whichwaySkinConfigAdd_enableWhichWayDynamicSkin\",\r\n\t\t\tpriority: 756,\r\n\t\t\tobj: {\r\n\t\t\t\tname: \"enableWhichWayDynamicSkin\",\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tname: \"启用驶舰之向动皮\",\r\n\t\t\t\t\tintro: \"选择后会启用驶舰之向动皮组件\",\r\n\t\t\t\t\tinit: true,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tonConfig({\r\n\t\t\tname: \"whichwaySkinConfigAdd_skinOverride\",\r\n\t\t\tpriority: 754,\r\n\t\t\tobj: {\r\n\t\t\t\tname: \"skinOverride\",\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tname: \"皮肤配置优先级\",\r\n\t\t\t\t\tintro: \"选择皮肤配置优先级\",\r\n\t\t\t\t\tinit: \"whichWay\",\r\n\t\t\t\t\titem: {\r\n\t\t\t\t\t\tnoname: \"本体优先\",\r\n\t\t\t\t\t\twhichWay: \"驶舰之向优先\",\r\n\t\t\t\t\t\tqhly: \"千幻聆音优先\",\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\t//导入动皮数据\r\n\t\tawait import(\"./dynamicConfig.js\");\r\n\t}\r\n\r\n\t/**\r\n\t * 初始化皮肤数据（只会读取本扩展的）\r\n\t */\r\n\tasync initSkinData() {\r\n\t\tconst { folders } = await whichWayFile.getFileTree(\"skin:\");\r\n\t\tfor (const folder of folders) {\r\n\t\t\tthis.skinData[folder.name] = {\r\n\t\t\t\tname: folder.name,\r\n\t\t\t\tskins: {},\r\n\t\t\t};\r\n\t\t\tif (folder.files.length > 0) {\r\n\t\t\t\tfor (const file of folder.files) {\r\n\t\t\t\t\tthis.skinData[folder.name].skins[file.name.replace(\".jpg\", \"\").replace(\".png\", \"\")] = {\r\n\t\t\t\t\t\tname: file.name,\r\n\t\t\t\t\t\tpath: file.path,\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 保存皮肤数据\r\n\t */\r\n\tasync saveSkinData() {\r\n\t\tawait whichWayFile.writeFileAsJson(\r\n\t\t\t{\r\n\t\t\t\tversion: whichWayVersion.ext,\r\n\t\t\t\tdata: this.skinData,\r\n\t\t\t},\r\n\t\t\t\"json:cache/\",\r\n\t\t\t\"skin.json\"\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * 自动更新皮肤数据\r\n\t * @param forced 是否强制更新\r\n\t */\r\n\tasync autoUpdateSkinData(forced = false) {\r\n\t\tif ((await whichWayFile.exsitFile(\"json:cache/skin.json\", \"file\")) && forced === false) {\r\n\t\t\tconst { version, data } = await whichWayFile.readFile(\"json:cache/skin.json\");\r\n\t\t\tif (version === whichWayVersion.ext) {\r\n\t\t\t\tthis.skinData = data;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tawait this.initSkinData();\r\n\t\tawait this.saveSkinData();\r\n\t}\r\n\r\n\t/**\r\n\t * 获取角色的皮肤，如果没有指定皮肤，则返回所有皮肤\r\n\t * @param name 角色名\r\n\t * @param skin 皮肤名（可选）\r\n\t * @returns 皮肤路径或皮肤名数组\r\n\t */\r\n\tgetCharacterSkin(name: string, skin?: string): Record<string, string> | undefined {\r\n\t\tif (!this.skinData[name]) return;\r\n\t\tif (!skin) {\r\n\t\t\tconst result = {};\r\n\t\t\tfor (const key in this.skinData[name].skins) {\r\n\t\t\t\tresult[key] = this.skinData[name].skins[key].path;\r\n\t\t\t}\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\tskin = whichWayFile.removeExt(skin);\r\n\t\treturn this.skinData[name].skins[skin];\r\n\t}\r\n\r\n\t/**\r\n\t * 设置角色皮肤\r\n\t */\r\n\tsetCharacterSkin(name: string, skin: string): void {\r\n\t\tif (whichWayUtil.isDeveloperMode()) console.log(`[whichWaySkin] setCharacterSkin ${name} ${skin}`);\r\n\t\tif (skin === \"经典形象\" && whichWaySkin._skinStore[name]) {\r\n\t\t\tthis.syncSkin({key:name,del:true});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst skinData = this.getCharacterSkin(name, skin);\r\n\t\tif (!skinData) return;\r\n\t\tthis.syncSkin({key:name,value:[skinData.name,skinData.path]});\r\n\t}\r\n\r\n\tsyncSkin({key, value,del}: {key:string,value?:[string,string|undefined],del?:boolean}){\r\n\t\tif(del === true){\r\n\t\t\tdelete this._skinStore[key];\r\n\t\t\tdelete window.whichWaySave.skinConfig[key];\r\n\t\t\tdelete lib.config.skin[key];\r\n\t\t\twhichWayUtil.saveConfig(\"skin\", lib.config.skin, undefined);\r\n\t\t\twhichWayUtil.saveConfig(\"skinConfig\", window.whichWaySave.skinConfig);\r\n\t\t}else{\r\n\t\t\tif(value === void 0) throw new Error(\"value is undefined\");\r\n\t\t\tthis._skinStore[key] = value;\r\n\t\t\twindow.whichWaySave.skinConfig[key] = value[0];\r\n\t\t\tlib.config.skin[key] = value;\r\n\t\t\twhichWayUtil.saveConfig(\"skin\", lib.config.skin, undefined);\r\n\t\t\twhichWayUtil.saveConfig(\"skinConfig\", window.whichWaySave.skinConfig);\r\n\t\t}\r\n\t}\r\n\r\n\trefreshSkin() {\r\n\t\tconst allPlayers = game.players.concat(game.dead);\r\n\t\tif (allPlayers.length === 0) return;\r\n\t\tfor (const player of allPlayers) {\r\n\t\t\tplayer.node.avatar.setBackground(player.name1, \"character\");\r\n\t\t\tif (player.name2) player.node.avatar2.setBackground(player.name2, \"character\");\r\n\t\t\tspineWorker.updateDyc(player.name, player);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 获取角色的当前皮肤\r\n\t */\r\n\tgetCurentSkin(name: string, igExt: boolean = true): string {\r\n\t\tlet skin = this._skinStore?.[name]?.[0];\r\n\t\tif (!skin) skin = \"经典形象.jpg\";\r\n\t\treturn igExt ? whichWayFile.removeExt(skin) : skin;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取角色的当前皮肤路径\r\n\t */\r\n\tgetCurrentSkinPath(name: string): string {\r\n\t\tlet skin = this._skinStore?.[name]?.[1];\r\n\t\tif (!skin) {\r\n\t\t\tif (window.whichWaySave.allCharacters.includes(name)) skin = whichWayFile.compilePath(`img:character/${name}.jpg`);\r\n\t\t\telse {\r\n\t\t\t\tconst char = get.character(name);\r\n\t\t\t\tif (char.img !== undefined) return char.img;\r\n\t\t\t\telse if (char.trashBin) {\r\n\t\t\t\t\tfor (let any of char.trashBin) {\r\n\t\t\t\t\t\tif (any.startsWith(\"ext:\")) {\r\n\t\t\t\t\t\t\treturn any.replace(\"ext:\", \"extension/\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn `image/character/${name}.jpg`;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn skin;\r\n\t}\r\n\r\n\t/**\r\n\t * 检查皮肤设置,不全的自动补全,并且判断是否需要同步\r\n\t */\r\n\tcheckSkinSetting() {\r\n\t\tlib.config.qhly_skinset ??= {\r\n\t\t\tskin: {\r\n\t\t\t\t//key-value方式，存放武将皮肤名\r\n\t\t\t},\r\n\t\t\tskinAudioList: {\r\n\t\t\t\t//key-value方式，存放武将皮肤配音\r\n\t\t\t},\r\n\t\t\taudioReplace: {\r\n\t\t\t\t//key-value方式，存放配音映射逻辑。\r\n\t\t\t},\r\n\t\t\tdjtoggle: {},\r\n\t\t};\r\n\t\tlib.config.qhly_skinset.skin ??= {};\r\n\t\tlib.config.qhly_skinset.skinAudioList ??= {};\r\n\t\tlib.config.qhly_skinset.audioReplace ??= {};\r\n\t\tlib.config.qhly_skinset.djtoggle ??= {};\r\n\r\n\t\tlib.config.skin ??= {};\r\n\r\n\t\tthis._skinStore = this._skinStore || {};\r\n\t}\r\n\r\n\t/**\r\n\t * 选择冲突皮肤\r\n\t */\r\n\tshowConflictedSkin() {\r\n\t\tconst overlay = ui.create.div(\".conflictedSkinOverlay-whichWaySkin .whichWayOverlay\", document.body);\r\n\t\tconst app = createApp(ConfOverride).mount(overlay);\r\n\t\treturn new Promise(resolve => {\r\n\t\t\tthis.pendingReslove[\"showConflictedSkin\"] = resolve;\r\n\t\t});\r\n\t}\r\n\r\n\tsyncAllSkinConfig() {\r\n\t\tif (this._isSyncing) return;\r\n\t\tthis._isSyncing = true;\r\n\t\tthis.checkSkinSetting();\r\n\r\n\t\tconst self = this;\r\n\r\n\t\tconst loadFrom = (obj: Record<string, any>, isTransformed: boolean) => {\r\n\t\t\tfor (const key in obj) {\r\n\t\t\t\tconst val = obj[key];\r\n\t\t\t\tif (isTransformed) {\r\n\t\t\t\t\tif (typeof val === \"string\") {\r\n\t\t\t\t\t\tconst existing = self._skinStore[key];\r\n\t\t\t\t\t\t//@ts-ignore\r\n\t\t\t\t\t\tconst path = self.getCharacterSkin(key, whichWayFile.removeExt(val))?.path ?? existing?.[1];\r\n\t\t\t\t\t\tself._skinStore[key] = [val, path];\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (Array.isArray(val) && val.length >= 1 && typeof val[0] === \"string\") {\r\n\t\t\t\t\t\tself._skinStore[key] = [val[0], val[1]];\r\n\t\t\t\t\t} else if (typeof val === \"string\") {\r\n\t\t\t\t\t\tself._skinStore[key] = [val, undefined];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\tconst config = whichWayUtil.config(\"skinOverride\");\r\n\t\tconst tasks = [\r\n\t\t\t{ key: \"whichWay\", run: () => loadFrom(window.whichWaySave?.skinConfig || {}, true) },\r\n\t\t\t{ key: \"noname\", run: () => loadFrom(lib.config.skin || {}, false) },\r\n\t\t\t{ key: \"qhly\", run: () => loadFrom(lib.config.qhly_skinset?.skin || {}, true) },\r\n\t\t];\r\n\r\n\t\tconst idx = tasks.findIndex(t => t.key === config);\r\n\t\tif (idx !== -1) {\r\n\t\t\ttasks.push(...tasks.splice(idx, 1));\r\n\t\t}\r\n\r\n\t\ttasks.forEach(t => t.run());\r\n\r\n\t\ttry {\r\n\t\t\tconst full = { ...this._skinStore };\r\n\t\t\tconst simple = this.transformSkinData(full);\r\n\r\n\t\t\tlib.config.skin = full;\r\n\t\t\tlib.config.qhly_skinset.skin = simple;\r\n\t\t\twindow.whichWaySave.skinConfig = simple;\r\n\r\n\t\t\twhichWayUtil.saveConfig(\"skin\", full, undefined);\r\n\t\t\twhichWayUtil.saveConfig(\"qhly_skinset\", lib.config.qhly_skinset, undefined);\r\n\t\t\twhichWayUtil.saveConfig(\"skinConfig\", window.whichWaySave.skinConfig);\r\n\t\t} finally {\r\n\t\t\tthis._isSyncing = false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 将本体皮肤数据格式转变为千幻、驶舰之向数据格式\r\n\t * - 若值为 [string, string] 数组，则取第一个元素；\r\n\t * - 否则保留原始值不变。\r\n\t */\r\n\ttransformSkinData(data: Record<string, unknown>): Record<string, string> {\r\n\t\treturn Object.fromEntries(\r\n\t\t\tObject.entries(data).map(([key, value]) => {\r\n\t\t\t\tif (Array.isArray(value) && value.length > 0 && typeof value[0] === \"string\") {\r\n\t\t\t\t\treturn [key, value[0]];\r\n\t\t\t\t}\r\n\t\t\t\treturn [key, String(value)];\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * 清除皮肤配置\r\n\t */\r\n\tclearSkinConfig() {\r\n\t\tif (!whichWayUtil.isDeveloperMode()) {\r\n\t\t\tconsole.warn(\"WhichWaySkin.clearSkinConfig can only be called in developer mode.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// 清空所有属性\r\n\t\tfor (const key in this._skinStore) {\r\n\t\t\tdelete this._skinStore[key];\r\n\t\t}\r\n\t}\r\n\r\n\tinitConfictedSkins() {\r\n\t\tthis.checkSkinSetting();\r\n\r\n\t\tconst skinConfig = window.whichWaySave.skinConfig;\r\n\t\tconst skin = lib.config.skin;\r\n\t\tconst qhly_skinset = lib.config.qhly_skinset.skin;\r\n\t\tconst selected = this.confictedSkins.selected;\r\n\r\n\t\tfor (const key in skinConfig) {\r\n\t\t\tif (selected[key] && [skinConfig[key], skin[key], qhly_skinset[key]].includes(selected[key])) continue;\r\n\t\t\t//暂时只处理本扩展武将\r\n\t\t\tif (!window.whichWaySave.allCharacters.includes(key)) continue;\r\n\r\n\t\t\tif (skin[key]) {\r\n\t\t\t\tif (Array.isArray(skin[key]) && skin[key][0] !== skinConfig[key]) {\r\n\t\t\t\t\tthis.confictedSkins.add(key, skin[key][0], \"noname\");\r\n\t\t\t\t\tthis.confictedSkins.add(key, skinConfig[key], \"whichWay\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (qhly_skinset[key] && qhly_skinset[key] !== skinConfig[key]) {\r\n\t\t\t\tthis.confictedSkins.add(key, qhly_skinset[key], \"qhly\");\r\n\t\t\t\tthis.confictedSkins.add(key, skinConfig[key], \"whichWay\");\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 皮肤数据\r\n\t */\r\n\tprivate skinData: Record<\r\n\t\tstring,\r\n\t\t{\r\n\t\t\tname: string;\r\n\t\t\tskins: Record<\r\n\t\t\t\tstring,\r\n\t\t\t\t{\r\n\t\t\t\t\tname: string;\r\n\t\t\t\t\tpath: string;\r\n\t\t\t\t}\r\n\t\t\t>;\r\n\t\t}\r\n\t> = {};\r\n\r\n\t/**\r\n\t * 共享的皮肤配置对象\r\n\t */\r\n\tprivate _skinStore: Record<string, [string, string | undefined]> = {};\r\n\r\n\tprivate _isSyncing = false;\r\n\r\n\t/**\r\n\t * 冲突的皮肤\r\n\t */\r\n\tconfictedSkins = confictedSkin;\r\n\r\n\t/**\r\n\t * 等待的Promise\r\n\t */\r\n\tpendingReslove: Record<string, any> = {};\r\n}\r\n\r\nexport const whichWaySkin = new WhichWaySkin();\r\n\r\nawait whichWaySkin.init();\r\n\r\nonSetDev({\r\n\tname: \"WhichWaySkin_dev\",\r\n\tfn: () => {\r\n\t\t//@ts-ignore\r\n\t\twindow.whichWaySkin = whichWaySkin;\r\n\t},\r\n});\r\n\r\nwindow.whichWay.register(\"skin\", whichWaySkin);\r\n"],"names":["mode"],"mappings":"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"}