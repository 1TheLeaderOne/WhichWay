{"version":3,"file":"decade.js","sources":["../../../../../../packages/extension/WhichWay/src/extCompatible/decade.js"],"sourcesContent":["import { whichWayFile } from \"../file.js\";\r\nimport { onArenaReady, onConfig, onContent } from \"../hooks/index.js\";\r\nimport { whichWayToast } from \"../toast/index.ts\";\r\nimport { whichWayUtil } from \"../utill.js\";\r\n\r\nclass DecadeExtCompatible {\r\n\tprefixPath = \"extension/十周年UI/\";\r\n\r\n\t/**\r\n\t * 启用的十周年UI的动皮效果\r\n\t * @type {[string]}\r\n\t */\r\n\tenableDecadeUISpineEffect = whichWayUtil.config(\"enableDecadeUISpineEffect\") || [\"effect_youxikaishi\", \"effect_shoujidonghua\", \"../../../十周年UI/assets/animation/globaltexiao/shanghaishuzi/SZN_shuzi\", \"effect_jisha1\", \"effect_xianding\", \"../../../十周年UI/assets/animation/globaltexiao/huifushuzi/shuzi2\"];\r\n\r\n\tcopys = [\r\n\t\t[whichWayFile.compilePath(\"img:decadeUI/group/name_sjzx_group.png\"), `${this.prefixPath}image/styles/decade/`],\r\n\t\t[whichWayFile.compilePath(\"img:decadeUI/images/name2_sjzx_group.png\"), `${this.prefixPath}image/styles/shousha/`],\r\n\t];\r\n\r\n\tasync init() {\r\n\t\tonConfig({\r\n            priority:600,\r\n\t\t\tname: \"WhichWay_decadeUI_addConfig\",\r\n\t\t\tobj: {\r\n\t\t\t\tname: \"banDecadeUIAnimation\",\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tname: \"十周年动画效果\",\r\n\t\t\t\t\tintro: \"可以关闭十周年UI的动画效果，在一定程度上避免动画纹理缺失导致的白屏\",\r\n\t\t\t\t\tinit: \"enable\",\r\n\t\t\t\t\titem: {\r\n\t\t\t\t\t\tenable: \"启用\",\r\n\t\t\t\t\t\tpartly: \"部分启用\",\r\n\t\t\t\t\t\tdisable: \"关闭\",\r\n\t\t\t\t\t},\r\n\t\t\t\t\tonclick:(item)=> {\r\n\t\t\t\t\t\tif (whichWayUtil.config(\"enable\", \"十周年UI\")) {\r\n\t\t\t\t\t\t\tdecadeExtCompatible.setDecadeUIAnimation(item);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\twhichWayToast.showToast(\"您已关闭了十周年UI，请勿使用此功能！\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tif (!whichWayUtil.config(\"enable\", \"十周年UI\")) return;\r\n\t\tif (this.noTipsCopyFile !== true) await this.copy();\r\n\t\tif (whichWayUtil.config(\"banDecadeUIAnimation\") !== \"enable\") {\r\n\t\t\tthis.setDecadeUIAnimation(whichWayUtil.config(\"banDecadeUIAnimation\"), true);\r\n\t\t}\r\n\t}\r\n\r\n\tasync copy() {\r\n\t\tconst confirm = window.confirm(`【驶舰之向】:是否将素材导入至十周年UI？`);\r\n\t\tthis.noTipsCopyFile = true;\r\n\r\n\t\tif (confirm !== true) return;\r\n\r\n\t\tonContent({\r\n\t\t\tname: \"WhichWay_decadeUI_copyFile\",\r\n\t\t\tfn: async () => {\r\n\t\t\t\tfor (const copy of this.copys) {\r\n\t\t\t\t\tawait whichWayFile.copyFile(copy[0], copy[1]);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * 控制是否显示十周年UI的部分动画\r\n\t *\r\n\t *\r\n\t * @param {\"enable\" | \"disable\" | \"partly\"} item - 是否显示十年UI动画画布\r\n\t *   - true: 显示所有动画\r\n\t *   - partly : 显示部分动画\r\n\t *   - false: 隐藏部分动画\r\n\t * @param {boolean} [arenReady=false] - 是否在游戏准备就绪后执行隐藏操作\r\n\t *   - true: 游戏准备就绪后执行\r\n\t *   - false: 立即执行隐藏操作\r\n\t * @returns {boolean | undefined} 返回传入的bool参数值，十周年UI未开启时为undefined\r\n\t */\r\n\tsetDecadeUIAnimation(item, arenReady = false) {\r\n\t\tif (item === \"enable\") {\r\n\t\t\t/** @ts-ignore */\r\n\t\t\tif (decadeUI.AnimationPlayer.prototype.copyPlaySpine) {\r\n\t\t\t\t/** @ts-ignore */\r\n\t\t\t\tdecadeUI.AnimationPlayer.prototype.playSpine = decadeUI.AnimationPlayer.prototype.copyPlaySpine;\r\n\t\t\t\t/** @ts-ignore */\r\n\t\t\t\tdelete decadeUI.AnimationPlayer.prototype.copyPlaySpine;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (arenReady) {\r\n                onArenaReady({\r\n                    name: \"WhichWay_decadeUI_setDecadeUIAnimation\",\r\n                    fn: () => {\r\n                        this.setDecadeUIAnimation(item, false);\r\n                    },\r\n                })\r\n\t\t\t} else {\r\n\t\t\t\tdisableAnimation();\r\n\t\t\t}\r\n\t\t}\r\n\t\twhichWayUtil.saveConfig(\"banDecadeUIAnimation\", item);\r\n\t\t/** @ts-ignore */\r\n\t\treturn item;\r\n\r\n\t\tfunction disableAnimation() {\r\n\t\t\t//@ts-ignore\r\n\t\t\tconst originalPlaySpine = decadeUI.AnimationPlayer.prototype.playSpine;\r\n\t\t\t//@ts-ignore\r\n\t\t\tdecadeUI.AnimationPlayer.prototype.copyPlaySpine = decadeUI.animation.playSpine;\r\n\t\t\t//@ts-ignore\r\n\t\t\tdecadeUI.AnimationPlayer.prototype.playSpine = function (sprite, position) {\r\n\t\t\t\tconst result = originalPlaySpine.call(this, sprite, position);\r\n\t\t\t\tif (whichWayUtil.isDeveloperMode() && !decadeExtCompatible.enableDecadeUISpineEffect.includes(result?.name)) console.log(result?.name);\r\n\t\t\t\t//@ts-ignore\r\n\t\t\t\tif (window.decadeUI && window.decadeUI.animation && whichWayUtil.config === \"partly\" && !decadeExtCompatible.enableDecadeUISpineEffect.includes(result?.name)) {\r\n\t\t\t\t\t//@ts-ignore\r\n\t\t\t\t\twindow.decadeUI.animation.stopSpineAll();\r\n\t\t\t\t\t//@ts-ignore\r\n\t\t\t\t\tif (window.decadeUI.animation.gl) window.decadeUI.animation.render(performance.now());\r\n\t\t\t\t} else if (whichWayUtil.config(\"banDecadeUIAnimation\") === \"disable\") {\r\n\t\t\t\t\t//@ts-ignore\r\n\t\t\t\t\tdocument.querySelector(\".animation-player\").style.display = \"none\";\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t};\r\n\t\t\t//@ts-ignore\r\n\t\t\tconst originalPlaySpineTo = decadeUI.AnimationPlayerPool.prototype.playSpineTo;\r\n\t\t\t//@ts-ignore\r\n\t\t\tdecadeUI.AnimationPlayerPool.prototype.playSpineTo = function (element, animation, position) {\r\n\t\t\t\tif (whichWayUtil.config(\"banDecadeUIAnimation\") === \"disable\") return;\r\n\t\t\t\treturn originalPlaySpineTo.call(this, element, animation, position);\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\tget noTipsCopyFile() {\r\n\t\treturn whichWayUtil.config(\"noTipsCopyFile\");\r\n\t}\r\n\tset noTipsCopyFile(value) {\r\n\t\twhichWayUtil.saveConfig(\"noTipsCopyFile\", value);\r\n\t}\r\n\r\n\tget banDecadeUIAnimation() {\r\n\t\treturn whichWayUtil.config(\"banDecadeUIAnimation\");\r\n\t}\r\n\tset banDecadeUIAnimation(value) {\r\n\t\twhichWayUtil.saveConfig(\"banDecadeUIAnimation\", value);\r\n\t}\r\n}\r\n\r\nexport const decadeExtCompatible = new DecadeExtCompatible();\r\n\r\nawait decadeExtCompatible.init();\r\n"],"names":[],"mappings":"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"}