{"version":3,"file":"index.js","sources":["../../../../../../packages/extension/WhichWay/src/audio/index.ts"],"sourcesContent":["import { whichWayArknight } from \"../arknight/index.ts\";\r\nimport { whichWayFile } from \"../file.js\";\r\nimport { lib, game, ui, get, ai, _status } from \"noname\";\r\nimport { onArenaReady, onConfig, onSetDev } from \"../hooks/index.js\";\r\nimport { whichWayUtil } from \"../utill.js\";\r\nimport { whichWayWebPlay } from \"./webPlay.ts\";\r\nimport { whichWayWebPlayDie } from \"./webPlayDie.ts\";\r\nimport { whichWayAPIOverride } from \"../override/index.js\";\r\nimport { whichWayToast } from \"../toast/index.ts\";\r\n\r\nconst audioSave = window.whichWaySave.audioConfig;\r\n\r\nclass WhichWayAudio {\r\n\t/**\r\n\t * PRTS路径\r\n\t */\r\n\tresourceUrl: string = `https://torappu.prts.wiki/`;\r\n\r\n\t/**\r\n\t * 全局配置中的默认语言\r\n\t * 只开放中、日，因为其他的某些角色不一定有\r\n\t */\r\n\tvaildDefaultLang: Array<ArkAllLangs> = [\"CN_MANDARIN\", \"JP\"];\r\n\r\n\t/**\r\n\t * 配音组件初始化\r\n\t */\r\n\tasync init(): Promise<void> {\r\n\t\tawait this.checkAudioFolder();\r\n\r\n\t\tonArenaReady({\r\n\t\t\tname: \"whichWayAudio_init\",\r\n\t\t\tfn: async () => {\r\n\t\t\t\tfor (const name of window.whichWaySave.allCharacters) {\r\n\t\t\t\t\tconst char = get.character(name);\r\n\t\t\t\t\t//@ts-ignore\r\n\t\t\t\t\tawait whichWayAudio.initDieAudio(char);\r\n\t\t\t\t\tfor (const skill of char.skills) {\r\n\t\t\t\t\t\tawait whichWayAudio.initAudio(skill, name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//覆盖api\r\n\t\t\t\tawait whichWayAudio.override();\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tonConfig({\r\n\t\t\tname: \"whichWayAudioDefaultConfig_add\",\r\n\t\t\tpriority: 777,\r\n\t\t\tobj: {\r\n\t\t\t\tname: \"audioDefaultLang\",\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tname: \"默认配音\",\r\n\t\t\t\t\tintro: \"默认配音语言\",\r\n\t\t\t\t\tinit: whichWayUtil.config(\"audioConfig\")?.default || \"CN_MANDARIN\",\r\n\t\t\t\t\titem: Object.fromEntries(this.vaildDefaultLang.map(i => [i, whichWayArknight.getVoiceLangTranslation(i)])),\r\n\t\t\t\t\tonclick(item: string) {\r\n\t\t\t\t\t\taudioSave.default = item;\r\n\t\t\t\t\t\twhichWayUtil.saveConfig(\"audioDefaultLang\", item);\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tonConfig({\r\n\t\t\tname: \"whichWayAudioUseLocalAudioConfig_add\",\r\n\t\t\tpriority: 776,\r\n\t\t\tobj: {\r\n\t\t\t\tname: \"useLocalAudio\",\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tname: \"强制使用本地音频\",\r\n\t\t\t\t\tintro: \"是否强制使用本地音频,开启后不会从PRTS请求音频\",\r\n\t\t\t\t\tinit: false,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tonConfig({\r\n\t\t\tname: \"whichWayAudioNoTipUseWebConfig_add\",\r\n\t\t\tobj: {\r\n\t\t\t\tname: \"noTipUseWeb\",\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tname: \"不提示使用网络\",\r\n\t\t\t\t\tintro: \"开启后获取PRTS上的配音时不会再提示'正在使用网络'\",\r\n\t\t\t\t\tinit: false,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tpriority: 775,\r\n\t\t});\r\n\r\n\t\tonConfig({\r\n\t\t\tname: \"whichWayAudioAutoDownloadAudio_add\",\r\n\t\t\tobj: {\r\n\t\t\t\tname: \"autoDownloadAudio\",\r\n\t\t\t\toptions: {\r\n\t\t\t\t\tname: \"自动下载缺失音频\",\r\n\t\t\t\t\tintro: \"开启后播放缺失音频时会自动下载\",\r\n\t\t\t\t\tinit: false,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tpriority: 774,\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * 检查音频文件夹是否存在，不存在则创建\r\n\t */\r\n\tasync checkAudioFolder(): Promise<void> {\r\n\t\tconst audioLangs = whichWayArknight.getVoiceLangs();\r\n\t\tfor (const lang of audioLangs) {\r\n\t\t\tif (await whichWayFile.exsitFile(`audio:${lang}`, \"folder\")) continue;\r\n\t\t\tawait whichWayFile.createFolder(`audio:${lang}`);\r\n\t\t\tawait whichWayFile.createFolder(`audio:${lang}/die`);\r\n\t\t}\r\n\t}\r\n\r\n\tasync override(): Promise<void> {\r\n\t\tawait whichWayAPIOverride.appendHook(\"game.trySkillAudio\", {\r\n\t\t\tbefore: async function (skill, player, directaudio, nobroadcast, skillInfo, args) {\r\n\t\t\t\tif (!lib.config.background_speak) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet trueSkill = whichWayAudio.getReferSkill(skill);\r\n\t\t\t\tlet info: Skill = skillInfo || lib.skill[trueSkill];\r\n\t\t\t\tlet infox = skillInfo || lib.skill[skill];\r\n\r\n\t\t\t\tif (!info) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (infox.direct && !directaudio) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (lib.skill.global.includes(skill) && !infox.forceaudio) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (infox.audioname2) {\r\n\t\t\t\t\tlet playername = typeof player === \"string\" ? player : get.name(player);\r\n\t\t\t\t\tfor (let name in infox.audioname2) {\r\n\t\t\t\t\t\tif (name.endsWith(\"mrfz\") && playername === name) {\r\n\t\t\t\t\t\t\treturn game.trySkillAudio(infox.audioname2[name], player, directaudio, nobroadcast, skillInfo, args);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (info.whichWayWebPlay && info.whichWayWebPlay.useLocalAudio === false) {\r\n\t\t\t\t\treturn info.whichWayWebPlay.play(trueSkill, typeof player === \"string\" ? player : get.name(player));\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tawait whichWayAPIOverride.appendHook(\"game.tryDieAudio\", {\r\n\t\t\tbefore: async function (player) {\r\n\t\t\t\tlet name = typeof player === \"string\" ? player : get.name(player);\r\n\r\n\t\t\t\tlet info: WhichWayCharacterPending = get.character(name!);\r\n\r\n\t\t\t\tif (info && info.whichWay && info.whichWay.dieAudio && (await whichWayAudio.exsitAudio(null!, name!, true))) {\r\n\t\t\t\t\treturn info.whichWay.dieAudio.play();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * 下载音频\r\n\t * @param {string} skill 技能名\r\n\t * @param {string} char 角色名\r\n\t * @param {boolean} [dieAudio=false] 是否是死亡音频\r\n\t */\r\n\tasync downloadAudio(skill: string, char: string, urls: string[], lang?: string, dieAudio: boolean = false): Promise<void> {\r\n\t\tif (urls === void 0) throw new Error(\"url is undefined\");\r\n\t\tif (lang === void 0) {\r\n\t\t\tlang = this.getCharacterLang(char);\r\n\t\t}\r\n\r\n\t\tconst path = whichWayFile.compilePath(`audio:${lang}${dieAudio ? \"/die\" : \"\"}/`);\r\n\r\n\t\tfor (let i = 0; i < urls.length; i++) {\r\n\t\t\tconst url = urls[i];\r\n\t\t\tconst audioIndex = i + 1;\r\n\t\t\tconst file = `${dieAudio ? char : `${skill}${audioIndex}`}.mp3`;\r\n\t\t\tawait whichWayFile.download(url, path, file);\r\n\t\t\twhichWayToast.showToast(`下载${file}成功`);\r\n\t\t\twhichWayToast.removeToastById(`whichWayAudioDownLoad_${file}`);\r\n\t\t}\r\n\r\n\t\tif(!dieAudio) await this.initAudio(skill,char);\r\n\t\t//@ts-ignore\r\n\t\telse await this.initDieAudio(get.character(char));\r\n\t}\r\n\r\n\t/**\r\n\t * 获取技能的配音语言\r\n\t * @param {string} skill 技能名\r\n\t * @param {string} char 角色名\r\n\t * @returns {string} 技能的配音语言\r\n\t */\r\n\tgetSkillLang(skill: string, char: string): string {\r\n\t\tconst defaultLang = this.getCharacterLang(char) || audioSave.default;\r\n\r\n\t\tif (char === void 0 || skill === void 0) throw new Error(\"char or skill is undefined\");\r\n\r\n\t\tif (!whichWayArknight.inArknightChars(char)) return \"CUSTOM\";\r\n\r\n\t\tlet custom = audioSave.custom;\r\n\t\tif (!custom[char]) return defaultLang;\r\n\t\tconst info = custom[char],\r\n\t\t\tskills = this.expandSkills(info.skills);\r\n\t\tif (skills.includes(skill)) return info.lang;\r\n\t\treturn defaultLang;\r\n\t}\r\n\r\n\t/**\r\n\t * 播放技能音频(无视trySkillAudio的限制)\r\n\t */\r\n\tplaySkillAudio(skill: string, name: string) {\r\n\t\tconst info = lib.skill[this.getReferSkill(skill)];\r\n\t\tif (!info) return;\r\n\t\tif (info.whichWayWebPlay && info.whichWayWebPlay.useLocalAudio === false) {\r\n\t\t\treturn info.whichWayWebPlay.play(skill, name);\r\n\t\t}\r\n\r\n\t\tconst audioList = get.Audio.skill({ skill, player: name }).fileList;\r\n\t\treturn game.tryAudio({ audioList });\r\n\t}\r\n\r\n\t/**\r\n\t * 扩展技能组\r\n\t */\r\n\texpandSkills(skills: string[]): string[] {\r\n\t\tconst result = [...skills];\r\n\t\tfor (const skill of skills) {\r\n\t\t\tlet info = lib.skill[skill];\r\n\t\t\t//@ts-ignore\r\n\t\t\tlet audio: string = info.audio;\r\n\t\t\tif (window.whichWaySave.allSkills.includes(audio)) {\r\n\t\t\t\tresult.push(this.getReferSkill(audio));\r\n\t\t\t}\r\n\t\t\tif (info.derivation) {\r\n\t\t\t\tconst extraSkills = Array.isArray(info.derivation) ? info.derivation : [info.derivation];\r\n\t\t\t\tfor (const extraSkill of extraSkills) {\r\n\t\t\t\t\tif (window.whichWaySave.allSkills.includes(extraSkill)) {\r\n\t\t\t\t\t\tresult.push(this.getReferSkill(extraSkill));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取角色的配音语言\r\n\t * @param {string} char 角色名\r\n\t * @param {boolean} [translate=false] 是否翻译\r\n\t * @returns {string} 角色的配音语言\r\n\t */\r\n\tgetCharacterLang(char: string, translate: boolean = false): string {\r\n\t\tif (char === void 0) throw new Error(\"char is undefined\");\r\n\r\n\t\tlet custom = audioSave.custom;\r\n\t\tif (!custom[char]) {\r\n\t\t\tlet langs = this.getCharacterAvailableLang(char);\r\n\t\t\tif (langs.length === 0) return autoTranslate(\"CUSTOM\");\r\n\t\t\tif (langs.includes(audioSave.default)) return autoTranslate(audioSave.default);\r\n\t\t\treturn autoTranslate(langs[0]);\r\n\t\t}\r\n\t\treturn autoTranslate(custom[char].lang);\r\n\r\n\t\tfunction autoTranslate(str: string): string {\r\n\t\t\treturn translate ? whichWayArknight.getVoiceLangTranslation(str)! : str;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 获取角色可用的配音语言\r\n\t * @param {string} char 角色名\r\n\t * @returns {string[]} 角色可用的配音语言\r\n\t */\r\n\tgetCharacterAvailableLang(char: string): string[] {\r\n\t\treturn get.character(char)?.whichWay?.arknight?.avaiableLangs || [];\r\n\t}\r\n\r\n\t/**\r\n\t * 技能的音频是否存在\r\n\t * @param {string} skill 技能名,如果是死亡配音此参数没有意义\r\n\t * @param {string} char 角色名\r\n\t * @param {boolean} [dieAudio=false] 是否是死亡音频\r\n\t * @returns {Promise<boolean>} 音频是否存在\r\n\t */\r\n\tasync exsitAudio(skill: string, char: string, dieAudio: boolean = false): Promise<boolean> {\r\n\t\tif (dieAudio === false) {\r\n\t\t\tconst info = lib.skill[skill];\r\n\t\t\tif (Array.isArray(info.audioname)) {\r\n\t\t\t\tconst find = info.audioname.find(i => i === char);\r\n\t\t\t\tif (find) skill = `${skill}_${find}1`;\r\n\t\t\t}\r\n\t\t}\r\n\t\tconst lang = dieAudio ? this.getCharacterLang(char) : this.getSkillLang(skill, char);\r\n\t\treturn await whichWayFile.exsitFile(dieAudio ? `audio:${lang}/die/${char}.mp3` : `audio:${lang}/${skill}1.mp3`);\r\n\t}\r\n\r\n\tasync setCustomAudio(char: string, lang: string): Promise<void> {\r\n\t\tconst skills = get.character(char)?.skills || [];\r\n\t\tif (!audioSave.custom[char]) audioSave.custom[char] = { lang: lang, skills: skills };\r\n\t\telse {\r\n\t\t\taudioSave.custom[char].lang = lang;\r\n\t\t\taudioSave.custom[char].skills = skills;\r\n\t\t}\r\n\r\n\t\twhichWayUtil.saveConfig(\"audioConfig\", audioSave);\r\n\r\n\t\tfor (const skill of skills) {\r\n\t\t\tawait this.initAudio(skill, char);\r\n\t\t}\r\n\r\n\t\t//@ts-ignore\r\n\t\tawait this.initDieAudio(get.character(char));\r\n\t}\r\n\r\n\t/**\r\n\t * 初始化技能的音频\r\n\t */\r\n\tasync initAudio(skill: string, char: string, range: Record<string, Skill> = lib.skill): Promise<void> {\r\n\t\tif (!window.whichWaySave.allSkills.includes(skill)) return;\r\n\t\tconst info = range[skill];\r\n\r\n\t\tif (!info.logAudio) {\r\n\t\t\tinfo.logAudio = () => info.audio;\r\n\t\t}\r\n\r\n\t\tconst lang = this.getSkillLang(skill, char);\r\n\t\tconst audio = info.audio;\r\n\t\tif (typeof audio === \"number\") {\r\n\t\t\tif (await this.exsitAudio(skill, char)) {\r\n\t\t\t\tinfo.audio = `ext:WhichWay/audio/${lang}:${audio}`;\r\n\t\t\t\tdelete info.whichWayWebPlay;\r\n\t\t\t} else if(lang !== \"CUSTOM\"){\r\n\t\t\t\tinfo.whichWayWebPlay = new whichWayWebPlay(skill, char);\r\n\t\t\t}\r\n\t\t} else if (typeof audio === \"string\") {\r\n\t\t\tif (audio.startsWith(\"ext:\")) {\r\n\t\t\t\t//@ts-ignore\r\n\t\t\t\tconst num = info.audio.split(\":\")[2];\r\n\t\t\t\tinfo.audio = `ext:WhichWay/audio/${lang}:${num}`;\r\n\t\t\t\tif (!(await this.exsitAudio(skill, char))) {\r\n\t\t\t\t\tif(lang !== \"CUSTOM\") info.whichWayWebPlay = new whichWayWebPlay(skill, char);\r\n\t\t\t\t} else delete info.whichWayWebPlay;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet realSkill = this.getReferSkill(skill);\r\n\t\t\tif (realSkill) await this.initAudio(realSkill, char, range);\r\n\t\t} else if (Array.isArray(audio)) {\r\n\t\t\tinfo.audio = `ext:WhichWay/audio/${lang}:${audio.length}`;\r\n\t\t\tif (!(await this.exsitAudio(skill, char))) {\r\n\t\t\t\t//@ts-ignore\r\n\t\t\t\tif(lang !== \"CUSTOM\") info.whichWayWebPlay = new whichWayWebPlay(skill, char, audio);\r\n\t\t\t} else delete info.whichWayWebPlay;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 初始化角色死亡音频\r\n\t * @param {WhichWayCharacter} char 角色\r\n\t */\r\n\tasync initDieAudio(char: WhichWayCharacter): Promise<void> {\r\n\t\tconst name = char.whichWay.charId;\r\n\r\n\t\t//@ts-ignore\r\n\t\tchar.dieAudios = [true, whichWayFile.compilePath(`audio:${this.getCharacterLang(name)}/die/${name}.mp3`)];\r\n\r\n\t\tif (!(await this.exsitAudio(null!, name, true))) {\r\n\t\t\tif(whichWayArknight.inArknightChars(name)) char.whichWay.dieAudio = new whichWayWebPlayDie(char);\r\n\t\t} else{\r\n\t\t\t//@ts-ignore\r\n\t\t\tif(char.whichWay.dieAudio) char.whichWay.dieAudio = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 查找引用技能的最终目标技能\r\n\t *\r\n\t * 该方法用于递归查找技能引用链的最终目标技能。当一个技能的 audio 属性引用了另一个技能时，\r\n\t * 会继续查找被引用技能的 audio 属性，直到找到不为字符串类型或为纯数字字符串的技能为止。\r\n\t *\r\n\t * 该方法会检测并处理循环引用情况，如果发现循环引用会输出警告并返回原始技能名。\r\n\t *\r\n\t * @param {string} name - 起始技能名称\r\n\t * @param {Set<string>} [visited=new Set()] - 已访问的技能集合，用于检测循环引用\r\n\t * @param {string} [lastName] - 上一个技能名称，用于返回默认值\r\n\t * @returns {string} 最终目标技能名称或上一个技能名称或起始技能名称\r\n\t */\r\n\tgetReferSkill(name: string, visited: Set<string> = new Set(), lastName?: string): string {\r\n\t\tif (visited.has(name)) {\r\n\t\t\tconsole.warn(`Circular reference detected at skill: ${name}`);\r\n\t\t\treturn name;\r\n\t\t}\r\n\r\n\t\tvisited.add(name);\r\n\r\n\t\tconst info = lib.skill[name];\r\n\t\tif (!info || !info.audio) return lastName || name;\r\n\r\n\t\tconst audio = info.audio;\r\n\t\tif (typeof audio === \"string\" && !/^\\d+$/.test(audio)) {\r\n\t\t\treturn this.getReferSkill(audio, visited, name);\r\n\t\t}\r\n\r\n\t\treturn name;\r\n\t}\r\n\r\n\t/**\r\n\t * 拼接成音频路径\r\n\t * @param {string} uid 角色UID\r\n\t * @param {string} lang 配音语言\r\n\t * @param {string} voiceTitle 音频标题\r\n\t * @returns {string} 音频路径\r\n\t */\r\n\tcompileVoicePath(uid: string, lang: string, voiceTitle: string): string {\r\n\t\tlang = this.transferLang(lang);\r\n\t\tuid = whichWayArknight.shcema.transfer(uid, \"character\", \"whichWayUID\") || uid;\r\n\t\tvoiceTitle = this.transferVoiceTitle(voiceTitle);\r\n\t\treturn `${this.resourceUrl}assets/audio/${lang}/${uid}/${voiceTitle}.wav`;\r\n\t}\r\n\r\n\t/**\r\n\t * 将配音语言转化为符合PRTS规范的格式\r\n\t * @param {string} lang 配音\r\n\t * @returns {string} 符合PRTS规范的格式\r\n\t */\r\n\ttransferLang(lang: string): string {\r\n\t\tif (whichWayArknight.getVoiceLangs().includes(lang)) {\r\n\t\t\tif (lang === \"JP\" || lang === \"LINKAGE\") return \"voice\";\r\n\t\t\telse if (lang === \"CN_MANDARIN\") {\r\n\t\t\t\treturn \"voice_cn\";\r\n\t\t\t} else {\r\n\t\t\t\treturn `voice_${lang.toLowerCase()}`;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn lang;\r\n\t}\r\n\r\n\t/**\r\n\t * 将音频标题转化为符合PRTS规范的格式\r\n\t * @param {string} voiceTitle 音频标题\r\n\t * @returns {string} 符合PRTS规范的格式\r\n\t */\r\n\ttransferVoiceTitle(voiceTitle: string): string {\r\n\t\tif (whichWayArknight.shcema.audio.index.includes(voiceTitle)) return voiceTitle;\r\n\t\tlet result = whichWayArknight.shcema.transfer(voiceTitle, \"audio\", \"index\");\r\n\t\tif (result === void 0) throw new Error(`voiceTitle ${voiceTitle} is not exist`);\r\n\t\treturn `cn_${result}`;\r\n\t}\r\n}\r\n\r\nexport const whichWayAudio = new WhichWayAudio();\r\n\r\nawait whichWayAudio.init();\r\n\r\nonSetDev({\r\n\tname: \"whichWayAudio_dev\",\r\n\tfn() {\r\n\t\t//@ts-ignore\r\n\t\twindow.whichWayAudio = whichWayAudio;\r\n\t},\r\n});\r\n\r\nwindow.whichWay.register(\"audio\", whichWayAudio);\r\n"],"names":[],"mappings":";;;;;;;;;AAUA,MAAM,YAAY,OAAO,aAAa;AAEtC,MAAM,cAAc;AAAA;AAAA;AAAA;AAAA,EAInB,cAAsB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMtB,mBAAuC,CAAC,eAAe,IAAI;AAAA;AAAA;AAAA;AAAA,EAK3D,MAAM,OAAsB;AAC3B,UAAM,KAAK,iBAAA;AAEX,iBAAa;AAAA,MACZ,MAAM;AAAA,MACN,IAAI,YAAY;AACf,mBAAW,QAAQ,OAAO,aAAa,eAAe;AACrD,gBAAM,OAAO,IAAI,UAAU,IAAI;AAE/B,gBAAM,cAAc,aAAa,IAAI;AACrC,qBAAW,SAAS,KAAK,QAAQ;AAChC,kBAAM,cAAc,UAAU,OAAO,IAAI;AAAA,UAC1C;AAAA,QACD;AAGA,cAAM,cAAc,SAAA;AAAA,MACrB;AAAA,IAAA,CACA;AAED,aAAS;AAAA,MACR,MAAM;AAAA,MACN,UAAU;AAAA,MACV,KAAK;AAAA,QACJ,MAAM;AAAA,QACN,SAAS;AAAA,UACR,MAAM;AAAA,UACN,OAAO;AAAA,UACP,MAAM,aAAa,OAAO,aAAa,GAAG,WAAW;AAAA,UACrD,MAAM,OAAO,YAAY,KAAK,iBAAiB,IAAI,CAAA,MAAK,CAAC,GAAG,iBAAiB,wBAAwB,CAAC,CAAC,CAAC,CAAC;AAAA,UACzG,QAAQ,MAAc;AACrB,sBAAU,UAAU;AACpB,yBAAa,WAAW,oBAAoB,IAAI;AAAA,UACjD;AAAA,QAAA;AAAA,MACD;AAAA,IACD,CACA;AAED,aAAS;AAAA,MACR,MAAM;AAAA,MACN,UAAU;AAAA,MACV,KAAK;AAAA,QACJ,MAAM;AAAA,QACN,SAAS;AAAA,UACR,MAAM;AAAA,UACN,OAAO;AAAA,UACP,MAAM;AAAA,QAAA;AAAA,MACP;AAAA,IACD,CACA;AAED,aAAS;AAAA,MACR,MAAM;AAAA,MACN,KAAK;AAAA,QACJ,MAAM;AAAA,QACN,SAAS;AAAA,UACR,MAAM;AAAA,UACN,OAAO;AAAA,UACP,MAAM;AAAA,QAAA;AAAA,MACP;AAAA,MAED,UAAU;AAAA,IAAA,CACV;AAED,aAAS;AAAA,MACR,MAAM;AAAA,MACN,KAAK;AAAA,QACJ,MAAM;AAAA,QACN,SAAS;AAAA,UACR,MAAM;AAAA,UACN,OAAO;AAAA,UACP,MAAM;AAAA,QAAA;AAAA,MACP;AAAA,MAED,UAAU;AAAA,IAAA,CACV;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,mBAAkC;AACvC,UAAM,aAAa,iBAAiB,cAAA;AACpC,eAAW,QAAQ,YAAY;AAC9B,UAAI,MAAM,aAAa,UAAU,SAAS,IAAI,IAAI,QAAQ,EAAG;AAC7D,YAAM,aAAa,aAAa,SAAS,IAAI,EAAE;AAC/C,YAAM,aAAa,aAAa,SAAS,IAAI,MAAM;AAAA,IACpD;AAAA,EACD;AAAA,EAEA,MAAM,WAA0B;AAC/B,UAAM,oBAAoB,WAAW,sBAAsB;AAAA,MAC1D,QAAQ,eAAgB,OAAO,QAAQ,aAAa,aAAa,WAAW,MAAM;AACjF,YAAI,CAAC,IAAI,OAAO,kBAAkB;AACjC;AAAA,QACD;AAEA,YAAI,YAAY,cAAc,cAAc,KAAK;AACjD,YAAI,OAAc,aAAa,IAAI,MAAM,SAAS;AAClD,YAAI,QAAQ,aAAa,IAAI,MAAM,KAAK;AAExC,YAAI,CAAC,MAAM;AACV;AAAA,QACD;AACA,YAAI,MAAM,UAAU,CAAC,aAAa;AACjC;AAAA,QACD;AACA,YAAI,IAAI,MAAM,OAAO,SAAS,KAAK,KAAK,CAAC,MAAM,YAAY;AAC1D;AAAA,QACD;AAEA,YAAI,MAAM,YAAY;AACrB,cAAI,aAAa,OAAO,WAAW,WAAW,SAAS,IAAI,KAAK,MAAM;AACtE,mBAAS,QAAQ,MAAM,YAAY;AAClC,gBAAI,KAAK,SAAS,MAAM,KAAK,eAAe,MAAM;AACjD,qBAAO,KAAK,cAAc,MAAM,WAAW,IAAI,GAAG,QAAQ,aAAa,aAAa,WAAW,IAAI;AAAA,YACpG;AAAA,UACD;AAAA,QACD;AACA,YAAI,KAAK,mBAAmB,KAAK,gBAAgB,kBAAkB,OAAO;AACzE,iBAAO,KAAK,gBAAgB,KAAK,WAAW,OAAO,WAAW,WAAW,SAAS,IAAI,KAAK,MAAM,CAAC;AAAA,QACnG;AAAA,MACD;AAAA,IAAA,CACA;AAED,UAAM,oBAAoB,WAAW,oBAAoB;AAAA,MACxD,QAAQ,eAAgB,QAAQ;AAC/B,YAAI,OAAO,OAAO,WAAW,WAAW,SAAS,IAAI,KAAK,MAAM;AAEhE,YAAI,OAAiC,IAAI,UAAU,IAAK;AAExD,YAAI,QAAQ,KAAK,YAAY,KAAK,SAAS,YAAa,MAAM,cAAc,WAAW,MAAO,MAAO,IAAI,GAAI;AAC5G,iBAAO,KAAK,SAAS,SAAS,KAAA;AAAA,QAC/B;AAAA,MACD;AAAA,IAAA,CACA;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,cAAc,OAAe,MAAc,MAAgB,MAAe,WAAoB,OAAsB;AACzH,QAAI,SAAS,OAAQ,OAAM,IAAI,MAAM,kBAAkB;AACvD,QAAI,SAAS,QAAQ;AACpB,aAAO,KAAK,iBAAiB,IAAI;AAAA,IAClC;AAEA,UAAM,OAAO,aAAa,YAAY,SAAS,IAAI,GAAG,WAAW,SAAS,EAAE,GAAG;AAE/E,aAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACrC,YAAM,MAAM,KAAK,CAAC;AAClB,YAAM,aAAa,IAAI;AACvB,YAAM,OAAO,GAAG,WAAW,OAAO,GAAG,KAAK,GAAG,UAAU,EAAE;AACzD,YAAM,aAAa,SAAS,KAAK,MAAM,IAAI;AAC3C,oBAAc,UAAU,KAAK,IAAI,IAAI;AACrC,oBAAc,gBAAgB,yBAAyB,IAAI,EAAE;AAAA,IAC9D;AAEA,QAAG,CAAC,SAAU,OAAM,KAAK,UAAU,OAAM,IAAI;AAAA,eAElC,KAAK,aAAa,IAAI,UAAU,IAAI,CAAC;AAAA,EACjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,aAAa,OAAe,MAAsB;AACjD,UAAM,cAAc,KAAK,iBAAiB,IAAI,KAAK,UAAU;AAE7D,QAAI,SAAS,UAAU,UAAU,OAAQ,OAAM,IAAI,MAAM,4BAA4B;AAErF,QAAI,CAAC,iBAAiB,gBAAgB,IAAI,EAAG,QAAO;AAEpD,QAAI,SAAS,UAAU;AACvB,QAAI,CAAC,OAAO,IAAI,EAAG,QAAO;AAC1B,UAAM,OAAO,OAAO,IAAI,GACvB,SAAS,KAAK,aAAa,KAAK,MAAM;AACvC,QAAI,OAAO,SAAS,KAAK,UAAU,KAAK;AACxC,WAAO;AAAA,EACR;AAAA;AAAA;AAAA;AAAA,EAKA,eAAe,OAAe,MAAc;AAC3C,UAAM,OAAO,IAAI,MAAM,KAAK,cAAc,KAAK,CAAC;AAChD,QAAI,CAAC,KAAM;AACX,QAAI,KAAK,mBAAmB,KAAK,gBAAgB,kBAAkB,OAAO;AACzE,aAAO,KAAK,gBAAgB,KAAK,OAAO,IAAI;AAAA,IAC7C;AAEA,UAAM,YAAY,IAAI,MAAM,MAAM,EAAE,OAAO,QAAQ,KAAA,CAAM,EAAE;AAC3D,WAAO,KAAK,SAAS,EAAE,WAAW;AAAA,EACnC;AAAA;AAAA;AAAA;AAAA,EAKA,aAAa,QAA4B;AACxC,UAAM,SAAS,CAAC,GAAG,MAAM;AACzB,eAAW,SAAS,QAAQ;AAC3B,UAAI,OAAO,IAAI,MAAM,KAAK;AAE1B,UAAI,QAAgB,KAAK;AACzB,UAAI,OAAO,aAAa,UAAU,SAAS,KAAK,GAAG;AAClD,eAAO,KAAK,KAAK,cAAc,KAAK,CAAC;AAAA,MACtC;AACA,UAAI,KAAK,YAAY;AACpB,cAAM,cAAc,MAAM,QAAQ,KAAK,UAAU,IAAI,KAAK,aAAa,CAAC,KAAK,UAAU;AACvF,mBAAW,cAAc,aAAa;AACrC,cAAI,OAAO,aAAa,UAAU,SAAS,UAAU,GAAG;AACvD,mBAAO,KAAK,KAAK,cAAc,UAAU,CAAC;AAAA,UAC3C;AAAA,QACD;AAAA,MACD;AAAA,IACD;AACA,WAAO;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,iBAAiB,MAAc,YAAqB,OAAe;AAClE,QAAI,SAAS,OAAQ,OAAM,IAAI,MAAM,mBAAmB;AAExD,QAAI,SAAS,UAAU;AACvB,QAAI,CAAC,OAAO,IAAI,GAAG;AAClB,UAAI,QAAQ,KAAK,0BAA0B,IAAI;AAC/C,UAAI,MAAM,WAAW,EAAG,QAAO,cAAc,QAAQ;AACrD,UAAI,MAAM,SAAS,UAAU,OAAO,EAAG,QAAO,cAAc,UAAU,OAAO;AAC7E,aAAO,cAAc,MAAM,CAAC,CAAC;AAAA,IAC9B;AACA,WAAO,cAAc,OAAO,IAAI,EAAE,IAAI;AAEtC,aAAS,cAAc,KAAqB;AAC3C,aAAO,YAAY,iBAAiB,wBAAwB,GAAG,IAAK;AAAA,IACrE;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,0BAA0B,MAAwB;AACjD,WAAO,IAAI,UAAU,IAAI,GAAG,UAAU,UAAU,iBAAiB,CAAA;AAAA,EAClE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,WAAW,OAAe,MAAc,WAAoB,OAAyB;AAC1F,QAAI,aAAa,OAAO;AACvB,YAAM,OAAO,IAAI,MAAM,KAAK;AAC5B,UAAI,MAAM,QAAQ,KAAK,SAAS,GAAG;AAClC,cAAM,OAAO,KAAK,UAAU,KAAK,CAAA,MAAK,MAAM,IAAI;AAChD,YAAI,KAAM,SAAQ,GAAG,KAAK,IAAI,IAAI;AAAA,MACnC;AAAA,IACD;AACA,UAAM,OAAO,WAAW,KAAK,iBAAiB,IAAI,IAAI,KAAK,aAAa,OAAO,IAAI;AACnF,WAAO,MAAM,aAAa,UAAU,WAAW,SAAS,IAAI,QAAQ,IAAI,SAAS,SAAS,IAAI,IAAI,KAAK,OAAO;AAAA,EAC/G;AAAA,EAEA,MAAM,eAAe,MAAc,MAA6B;AAC/D,UAAM,SAAS,IAAI,UAAU,IAAI,GAAG,UAAU,CAAA;AAC9C,QAAI,CAAC,UAAU,OAAO,IAAI,EAAG,WAAU,OAAO,IAAI,IAAI,EAAE,MAAY,OAAA;AAAA,SAC/D;AACJ,gBAAU,OAAO,IAAI,EAAE,OAAO;AAC9B,gBAAU,OAAO,IAAI,EAAE,SAAS;AAAA,IACjC;AAEA,iBAAa,WAAW,eAAe,SAAS;AAEhD,eAAW,SAAS,QAAQ;AAC3B,YAAM,KAAK,UAAU,OAAO,IAAI;AAAA,IACjC;AAGA,UAAM,KAAK,aAAa,IAAI,UAAU,IAAI,CAAC;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,UAAU,OAAe,MAAc,QAA+B,IAAI,OAAsB;AACrG,QAAI,CAAC,OAAO,aAAa,UAAU,SAAS,KAAK,EAAG;AACpD,UAAM,OAAO,MAAM,KAAK;AAExB,QAAI,CAAC,KAAK,UAAU;AACnB,WAAK,WAAW,MAAM,KAAK;AAAA,IAC5B;AAEA,UAAM,OAAO,KAAK,aAAa,OAAO,IAAI;AAC1C,UAAM,QAAQ,KAAK;AACnB,QAAI,OAAO,UAAU,UAAU;AAC9B,UAAI,MAAM,KAAK,WAAW,OAAO,IAAI,GAAG;AACvC,aAAK,QAAQ,sBAAsB,IAAI,IAAI,KAAK;AAChD,eAAO,KAAK;AAAA,MACb,WAAU,SAAS,UAAS;AAC3B,aAAK,kBAAkB,IAAI,gBAAgB,OAAO,IAAI;AAAA,MACvD;AAAA,IACD,WAAW,OAAO,UAAU,UAAU;AACrC,UAAI,MAAM,WAAW,MAAM,GAAG;AAE7B,cAAM,MAAM,KAAK,MAAM,MAAM,GAAG,EAAE,CAAC;AACnC,aAAK,QAAQ,sBAAsB,IAAI,IAAI,GAAG;AAC9C,YAAI,CAAE,MAAM,KAAK,WAAW,OAAO,IAAI,GAAI;AAC1C,cAAG,SAAS,SAAU,MAAK,kBAAkB,IAAI,gBAAgB,OAAO,IAAI;AAAA,QAC7E,cAAc,KAAK;AACnB;AAAA,MACD;AACA,UAAI,YAAY,KAAK,cAAc,KAAK;AACxC,UAAI,UAAW,OAAM,KAAK,UAAU,WAAW,MAAM,KAAK;AAAA,IAC3D,WAAW,MAAM,QAAQ,KAAK,GAAG;AAChC,WAAK,QAAQ,sBAAsB,IAAI,IAAI,MAAM,MAAM;AACvD,UAAI,CAAE,MAAM,KAAK,WAAW,OAAO,IAAI,GAAI;AAE1C,YAAG,SAAS,SAAU,MAAK,kBAAkB,IAAI,gBAAgB,OAAO,MAAM,KAAK;AAAA,MACpF,cAAc,KAAK;AAAA,IACpB;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,aAAa,MAAwC;AAC1D,UAAM,OAAO,KAAK,SAAS;AAG3B,SAAK,YAAY,CAAC,MAAM,aAAa,YAAY,SAAS,KAAK,iBAAiB,IAAI,CAAC,QAAQ,IAAI,MAAM,CAAC;AAExG,QAAI,CAAE,MAAM,KAAK,WAAW,MAAO,MAAM,IAAI,GAAI;AAChD,UAAG,iBAAiB,gBAAgB,IAAI,QAAQ,SAAS,WAAW,IAAI,mBAAmB,IAAI;AAAA,IAChG,OAAM;AAEL,UAAG,KAAK,SAAS,SAAU,MAAK,SAAS,WAAW;AAAA,IACrD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAeA,cAAc,MAAc,UAAuB,oBAAI,IAAA,GAAO,UAA2B;AACxF,QAAI,QAAQ,IAAI,IAAI,GAAG;AACtB,cAAQ,KAAK,yCAAyC,IAAI,EAAE;AAC5D,aAAO;AAAA,IACR;AAEA,YAAQ,IAAI,IAAI;AAEhB,UAAM,OAAO,IAAI,MAAM,IAAI;AAC3B,QAAI,CAAC,QAAQ,CAAC,KAAK,cAAc,YAAY;AAE7C,UAAM,QAAQ,KAAK;AACnB,QAAI,OAAO,UAAU,YAAY,CAAC,QAAQ,KAAK,KAAK,GAAG;AACtD,aAAO,KAAK,cAAc,OAAO,SAAS,IAAI;AAAA,IAC/C;AAEA,WAAO;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,iBAAiB,KAAa,MAAc,YAA4B;AACvE,WAAO,KAAK,aAAa,IAAI;AAC7B,UAAM,iBAAiB,OAAO,SAAS,KAAK,aAAa,aAAa,KAAK;AAC3E,iBAAa,KAAK,mBAAmB,UAAU;AAC/C,WAAO,GAAG,KAAK,WAAW,gBAAgB,IAAI,IAAI,GAAG,IAAI,UAAU;AAAA,EACpE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,aAAa,MAAsB;AAClC,QAAI,iBAAiB,cAAA,EAAgB,SAAS,IAAI,GAAG;AACpD,UAAI,SAAS,QAAQ,SAAS,UAAW,QAAO;AAAA,eACvC,SAAS,eAAe;AAChC,eAAO;AAAA,MACR,OAAO;AACN,eAAO,SAAS,KAAK,YAAA,CAAa;AAAA,MACnC;AAAA,IACD;AACA,WAAO;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,mBAAmB,YAA4B;AAC9C,QAAI,iBAAiB,OAAO,MAAM,MAAM,SAAS,UAAU,EAAG,QAAO;AACrE,QAAI,SAAS,iBAAiB,OAAO,SAAS,YAAY,SAAS,OAAO;AAC1E,QAAI,WAAW,OAAQ,OAAM,IAAI,MAAM,cAAc,UAAU,eAAe;AAC9E,WAAO,MAAM,MAAM;AAAA,EACpB;AACD;AAEO,MAAM,gBAAgB,IAAI,cAAA;AAEjC,MAAM,cAAc,KAAA;AAEpB,SAAS;AAAA,EACR,MAAM;AAAA,EACN,KAAK;AAEJ,WAAO,gBAAgB;AAAA,EACxB;AACD,CAAC;AAED,OAAO,SAAS,SAAS,SAAS,aAAa;"}