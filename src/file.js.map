{"version":3,"file":"file.js","sources":["../../../../../packages/extension/WhichWay/src/file.js"],"sourcesContent":["import { lib, game, ui, get, ai, _status } from \"noname\";\r\nimport { onSetDev, onContent } from \"./hooks/index.js\";\r\nimport { whichWayToast } from \"./toast/index.ts\";\r\nimport { whichWayUtil } from \"./utill.js\";\r\n\r\nclass WhichWayFile {\r\n\t/**\r\n\t * 驶舰之向扩展根目录\r\n\t */\r\n\textDir = `${lib.assetURL}extension/WhichWay/`;\r\n\r\n\t/**\r\n\t * 路径映射\r\n\t * @type {Record<string,string>}\r\n\t */\r\n\tpathShceme = {\r\n\t\t\"noname:\": \"\",\r\n\t\t\"src:\": `${this.extDir}src/`,\r\n\t\t\"pack:\": `${this.extDir}src/character/packs/`,\r\n\t\t\"bg:\": `${this.extDir}image/background/`,\r\n\t\t\"dec:\": `${this.extDir}image/decoration/`,\r\n\t\t\"json:\": `${this.extDir}json/`,\r\n\t\t\"audio:\": `${this.extDir}audio/`,\r\n\t\t\"css:\": `${this.extDir}css/`,\r\n\t\t\"skin:\": `${this.extDir}image/skin/`,\r\n\t\t\"ui:\": `${this.extDir}image/ui/`,\r\n\t\t\"img:\": `${this.extDir}image/`,\r\n\t\t\"dyc:\": `${this.extDir}dynamicSkin/illust/`,\r\n\t\t\"mod:\": `${this.extDir}image/modules/`,\r\n\t\t\"test:\": `${this.extDir}test/`,\r\n\t};\r\n\r\n\t/**\r\n\t * 编译路径\r\n\t * @param { string } path 路径\r\n\t *\r\n\t * @returns { string }\r\n\t */\r\n\tcompilePath(path) {\r\n\t\tfor (let key in this.pathShceme) {\r\n\t\t\tif (path.startsWith(key)) path = path.replace(key, this.pathShceme[key]);\r\n\t\t}\r\n\t\treturn path;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取是什么平台\r\n\t * @returns {\"browser\" | \"cordova\" | \"node\"}\r\n\t */\r\n\tdetectPlatform() {\r\n\t\tlet platform = \"browser\";\r\n\t\t//@ts-ignore\r\n\t\tif (window !== void 0 && window.cordova) platform = \"cordova\";\r\n\t\telse if (typeof process !== \"undefined\" && process.versions && process.versions.node) platform = \"node\";\r\n\t\t//@ts-ignore\r\n\t\treturn platform;\r\n\t}\r\n\r\n\t/**\r\n\t * 复制文件\r\n\t * @param {string} source - 源文件完整路径（含文件名）\r\n\t * @param {string} target - 目标位置（可以是目录路径或完整文件路径）\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tasync copyFile(source, target) {\r\n\t\t// 编译路径\r\n\t\tsource = this.compilePath(source);\r\n\t\ttarget = this.compilePath(target);\r\n\r\n\t\tconst data = await game.promises.readFile(source);\r\n\r\n\t\tlet targetDir, targetName;\r\n\r\n\t\tif (target.endsWith(\"/\")) {\r\n\t\t\ttargetDir = target;\r\n\t\t\ttargetName = source.slice(source.lastIndexOf(\"/\") + 1);\r\n\t\t} else {\r\n\t\t\ttargetDir = target.slice(0, target.lastIndexOf(\"/\") + 1);\r\n\t\t\ttargetName = target.slice(target.lastIndexOf(\"/\") + 1);\r\n\t\t}\r\n\r\n\t\tawait game.promises.writeFile(data, targetDir, targetName);\r\n\t}\r\n\r\n\t/**\r\n\t * 下载文件\r\n\t * 成功后返回 true，失败返回 false\r\n\t * @param {string} url\r\n\t * @param {string} dir - 保存目录（不包含文件名）\r\n\t * @param {string} [filename]\r\n\t * @param {function({ loaded: number, total: number|null, percent: number|null }): void} [onprogress]\r\n\t *\r\n\t * @returns {Promise<boolean>}\r\n\t */\r\n\tasync download(url, dir, filename, onprogress) {\r\n\t\tif (typeof game.download !== \"function\") {\r\n\t\t\tthrow new Error(`Download function ( game.download ) not available in current environment (${this.detectPlatform()}) .`);\r\n\t\t}\r\n\r\n\t\tdir = this.compilePath(dir);\r\n\t\tif (!filename) {\r\n\t\t\tconst idx = url.lastIndexOf(\"/\");\r\n\t\t\tif (idx === -1) throw new Error(\"Invalid URL\");\r\n\t\t\tfilename = url.slice(idx + 1).split(\"?\")[0];\r\n\t\t}\r\n\t\tconst fullPath = dir + filename;\r\n\r\n\t\tconst isCordova = this.detectPlatform() === \"cordova\";\r\n\r\n\t\t// node端提前获取文件大小\r\n\t\tlet totalSize = null;\r\n\t\tif (!isCordova && onprogress) {\r\n\t\t\ttry {\r\n\t\t\t\ttotalSize = await this.getFileSize(url);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.warn(\"Failed to get file size:\", err);\r\n\t\t\t\ttotalSize = null;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 统一格式\r\n\t\tconst wrappedOnProgress = onprogress\r\n\t\t\t? (loaded, totalFromCordova) => {\r\n\t\t\t\t\tconst total = isCordova ? totalFromCordova : totalSize;\r\n\t\t\t\t\tconst percent = total ? Math.min(99, Math.floor((loaded / total) * 100)) : null;\r\n\t\t\t\t\tonprogress({ loaded, total, percent });\r\n\t\t\t\t}\r\n\t\t\t: undefined;\r\n\r\n\t\ttry {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\t//@ts-ignore\r\n\t\t\t\tgame.download(\r\n\t\t\t\t\turl,\r\n\t\t\t\t\tfullPath,\r\n\t\t\t\t\t() => resolve(true),\r\n\t\t\t\t\terr => {\r\n\t\t\t\t\t\tconsole.warn(`Failed to download \"${url}\": ${err.message}`);\r\n\t\t\t\t\t\treject(false);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tundefined, // dev\r\n\t\t\t\t\twrappedOnProgress\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\t//@ts-ignore\r\n\t\t\tconsole.warn(`Failed to download \"${url}\": ${e.message}`);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 生成一个下载的进度提示函数（用于donwload的onprocess参数）\r\n\t * @param {Object} info 下载信息\r\n\t * @param {string} file 文件名\r\n\t * @param {string} toastID 进度提示toast的ID\r\n\t */\r\n\tgenerateProgress(info, file, toastID) {\r\n\t\tconst { loaded, total, percent } = info;\r\n\t\tif (percent !== null) {\r\n\t\t\tif (whichWayUtil.isDeveloperMode()) console.log(`正在下载文件${file}: ${percent}%`);\r\n\t\t\twhichWayToast.showToast(`正在下载文件${file}: ${percent}%`, 3000, \"topRight\", toastID);\r\n\t\t} else {\r\n\t\t\tif (whichWayUtil.isDeveloperMode()) {\r\n\t\t\t\tconsole.log(`正在下载文件 ${file}: ${loaded} bytes`);\r\n\t\t\t}\r\n\t\t\twhichWayToast.showToast(`正在下载文件 ${file}: ${Math.floor(loaded / 1024)} KB`, 3000, \"topRight\", toastID);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 通过 HEAD 请求获取远程文件大小 (只有node环境才能用)\r\n\t * @param {string} url\r\n\t * @returns {Promise<number|null>}\r\n\t */\r\n\tasync getFileSize(url) {\r\n\t\tif (this.detectPlatform() !== \"node\") {\r\n\t\t\tconsole.warn(`[WhichWayFile] getFileSize is not supported in ${this.detectPlatform()} environment`);\r\n\t\t\treturn null;\r\n\t\t}\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst protocol = url.startsWith(\"https\") ? require(\"https\") : require(\"http\");\r\n\t\t\tconst req = protocol.request(url, { method: \"HEAD\", headers: { \"User-Agent\": \"AppleWebkit\" } }, res => {\r\n\t\t\t\tconst len = res.headers[\"content-length\"];\r\n\t\t\t\tresolve(len ? parseInt(len, 10) : null);\r\n\t\t\t});\r\n\t\t\treq.on(\"error\", reject);\r\n\t\t\treq.end();\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * 判断文件是否存在\r\n\t * @param { string } path 路径\r\n\t * @param {\"file\" | \"folder\" | \"any\"} [type = \"any\"] 检查类型\r\n\t *\r\n\t * @returns {Promise<boolean>}\r\n\t */\r\n\tasync exsitFile(path, type = \"any\") {\r\n\t\tpath = this.compilePath(path);\r\n\t\tif (type === \"file\") {\r\n\t\t\treturn (await game.promises.checkFile(path)) > 0;\r\n\t\t} else if (type === \"folder\") {\r\n\t\t\treturn (await game.promises.checkDir(path)) > 0;\r\n\t\t} else {\r\n\t\t\treturn (await game.promises.checkFile(path)) > 0 || (await game.promises.checkDir(path)) > 0;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 创建文件夹\r\n\t * @param { string } path 路径\r\n\t *\r\n\t * @returns {Promise<void>}\r\n\t */\r\n\tasync createFolder(path) {\r\n\t\tpath = this.compilePath(path);\r\n\t\treturn await game.promises.createDir(path);\r\n\t}\r\n\r\n\t/**\r\n\t * @typedef {Object} FileItem\r\n\t * @property {string} name - 文件名\r\n\t * @property {string} path - 完整路径\r\n\t */\r\n\t/**\r\n\t * @typedef {Object} FolderItem\r\n\t * @property {string} name - 文件夹名\r\n\t * @property {string} path - 完整路径\r\n\t * @property {FileItem[]} files - **直接子文件**列表（不含子文件夹中的文件）\r\n\t * @property {FolderItem[]} folders - **子文件夹**列表（递归结构，受 `step` 限制）\r\n\t */\r\n\t/**\r\n\t * 获取指定路径下的文件树结构\r\n\t *\r\n\t * @param {string} path - 起始目录路径\r\n\t * @param {number} [step=3] - 递归深度（文件夹嵌套层数），默认 3；0 表示不递归子文件夹\r\n\t * @returns {Promise<{ files: FileItem[], folders: FolderItem[] }>}\r\n\t */\r\n\tasync getFileTree(path, step = 3) {\r\n\t\tpath = this.compilePath(path);\r\n\r\n\t\ttry {\r\n\t\t\tconst [folders, files] = await game.promises.getFileList(path);\r\n\t\t\t/** @type {FileItem[]} */\r\n\t\t\tconst fileObjs = files.map(name => ({\r\n\t\t\t\tname,\r\n\t\t\t\tpath: path + name,\r\n\t\t\t}));\r\n\r\n\t\t\t/** @type {FolderItem[]} */\r\n\t\t\tconst folderObjs = [];\r\n\r\n\t\t\tfor (const folderName of folders) {\r\n\t\t\t\tconst folderPath = path + folderName;\r\n\t\t\t\tconst [subFolders, subFiles] = await game.promises.getFileList(folderPath);\r\n\r\n\t\t\t\tconst directFiles = subFiles.map(name => ({\r\n\t\t\t\t\tname,\r\n\t\t\t\t\tpath: folderPath + \"/\" + name,\r\n\t\t\t\t}));\r\n\r\n\t\t\t\t/** @type {FolderItem} */\r\n\t\t\t\tconst folderObj = {\r\n\t\t\t\t\tname: folderName,\r\n\t\t\t\t\tpath: folderPath,\r\n\t\t\t\t\tfiles: directFiles,\r\n\t\t\t\t\tfolders: [],\r\n\t\t\t\t};\r\n\t\t\t\tconst subtree = await this.getFileTree(folderPath, step - 1);\r\n\t\t\t\tif (step > 1) {\r\n\t\t\t\t\tconst subtree = await this.getFileTree.call(this, folderPath, step - 1);\r\n\t\t\t\t\tfolderObj.folders = subtree.folders;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfolderObjs.push(folderObj);\r\n\t\t\t}\r\n\r\n\t\t\treturn { files: fileObjs, folders: folderObjs };\r\n\t\t} catch (e) {\r\n\t\t\t//@ts-ignore\r\n\t\t\tconsole.warn(`[WhichWayFile] Failed to get file list of \"${path}\": ${e.message}`);\r\n\t\t\treturn { files: [], folders: [] };\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 读取文件内容,会自动解析json文件\r\n\t * @param {string} path 文件路径\r\n\t */\r\n\tasync readFile(path) {\r\n\t\tpath = this.compilePath(path);\r\n\t\t//手动识别类型\r\n\t\tconst type = this.getFileExtension(path);\r\n\t\tif ([\"json\", \"txt\"].includes(type)) {\r\n\t\t\tconst result = await game.promises.readFileAsText(path);\r\n\t\t\treturn type == \"json\" ? JSON.parse(result) : result;\r\n\t\t}\r\n\t\treturn await game.promises.readFile(path);\r\n\t}\r\n\r\n\t/**\r\n\t * 获取要读取的文件的扩展名\r\n\t * @param {string} path 路径\r\n\t *\r\n\t * @returns {string}\r\n\t */\r\n\tgetFileExtension(path) {\r\n\t\tconst index = path.lastIndexOf(\".\");\r\n\t\tif (index == -1) {\r\n\t\t\tconsole.warn(`\"${path}\" has no file extension`);\r\n\t\t\treturn \"\";\r\n\t\t}\r\n\t\treturn path.slice(index + 1);\r\n\t}\r\n\r\n\t/**\r\n\t * 写入Json文件\r\n\t * @param {any} obj 内容\r\n\t * @param {string} path 文件路径\r\n\t * @param {string} [name] 文件名\r\n\t */\r\n\twriteFileAsJson(obj, path, name) {\r\n\t\tpath = this.compilePath(path);\r\n\t\ttry {\r\n\t\t\tconst jsonString = JSON.stringify(obj, null, 2);\r\n\t\t\treturn game.promises.writeFile(jsonString, path, name);\r\n\t\t} catch (error) {\r\n\t\t\treturn Promise.reject(new Error(`Failed to serialize object to JSON: ${error}`));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 移除文件扩展名\r\n\t * @param {string} str 文件名\r\n\t *\r\n\t * @returns {string}\r\n\t */\r\n\tremoveExt(str) {\r\n\t\tconst index = str.lastIndexOf(\".\");\r\n\t\tif (index == -1) {\r\n\t\t\treturn str;\r\n\t\t}\r\n\t\treturn str.slice(0, index);\r\n\t}\r\n\r\n\t/**\r\n\t * 加载CSS文件\r\n\t * @param {string} path 文件路径\r\n\t */\r\n\tloadCSS(path) {\r\n\t\tpath = this.compilePath(path);\r\n\t\tconst link = document.createElement(\"link\");\r\n\t\tlink.rel = \"stylesheet\";\r\n\t\tlink.href = path;\r\n\t\tdocument.head.appendChild(link);\r\n\t}\r\n\r\n\t/**\r\n\t * 自动加载扩展内的css文件\r\n\t */\r\n\tasync autoLoadCSS() {\r\n\t\tconst { files } = await this.getFileTree(\"css:\");\r\n\t\tconst loaded = [];\r\n\t\tfiles.forEach(file => {\r\n\t\t\tif (file.name.endsWith(\".css\")) {\r\n\t\t\t\tthis.loadCSS(file.path);\r\n\t\t\t\tloaded.push(file.name);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tif (whichWayUtil.isDeveloperMode()) console.log(`[WhichWayFile] Auto loaded CSS files: ${loaded.join(\", \")}`);\r\n\t}\r\n}\r\n\r\nexport const whichWayFile = new WhichWayFile();\r\n\r\nonSetDev({\r\n\tname: \"WhichWayFile_dev\",\r\n\tfn: () => {\r\n\t\t//@ts-ignore\r\n\t\twindow.whichWayFile = whichWayFile;\r\n\t},\r\n});\r\n\r\nwindow.whichWay.register(\"file\", whichWayFile);\r\n"],"names":["subtree"],"mappings":";;;;AAKA,MAAM,aAAa;AAAA;AAAA;AAAA;AAAA,EAIlB,SAAS,GAAG,IAAI,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,EAMxB,aAAa;AAAA,IACZ,WAAW;AAAA,IACX,QAAQ,GAAG,KAAK,MAAM;AAAA,IACtB,SAAS,GAAG,KAAK,MAAM;AAAA,IACvB,OAAO,GAAG,KAAK,MAAM;AAAA,IACrB,QAAQ,GAAG,KAAK,MAAM;AAAA,IACtB,SAAS,GAAG,KAAK,MAAM;AAAA,IACvB,UAAU,GAAG,KAAK,MAAM;AAAA,IACxB,QAAQ,GAAG,KAAK,MAAM;AAAA,IACtB,SAAS,GAAG,KAAK,MAAM;AAAA,IACvB,OAAO,GAAG,KAAK,MAAM;AAAA,IACrB,QAAQ,GAAG,KAAK,MAAM;AAAA,IACtB,QAAQ,GAAG,KAAK,MAAM;AAAA,IACtB,QAAQ,GAAG,KAAK,MAAM;AAAA,IACtB,SAAS,GAAG,KAAK,MAAM;AAAA,EACzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQC,YAAY,MAAM;AACjB,aAAS,OAAO,KAAK,YAAY;AAChC,UAAI,KAAK,WAAW,GAAG,EAAG,QAAO,KAAK,QAAQ,KAAK,KAAK,WAAW,GAAG,CAAC;AAAA,IACxE;AACA,WAAO;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,iBAAiB;AAChB,QAAI,WAAW;AAEf,QAAI,WAAW,UAAU,OAAO,QAAS,YAAW;AAAA,aAC3C,OAAO,YAAY,eAAe,QAAQ,YAAY,QAAQ,SAAS,KAAM,YAAW;AAEjG,WAAO;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,SAAS,QAAQ,QAAQ;AAE9B,aAAS,KAAK,YAAY,MAAM;AAChC,aAAS,KAAK,YAAY,MAAM;AAEhC,UAAM,OAAO,MAAM,KAAK,SAAS,SAAS,MAAM;AAEhD,QAAI,WAAW;AAEf,QAAI,OAAO,SAAS,GAAG,GAAG;AACzB,kBAAY;AACZ,mBAAa,OAAO,MAAM,OAAO,YAAY,GAAG,IAAI,CAAC;AAAA,IACtD,OAAO;AACN,kBAAY,OAAO,MAAM,GAAG,OAAO,YAAY,GAAG,IAAI,CAAC;AACvD,mBAAa,OAAO,MAAM,OAAO,YAAY,GAAG,IAAI,CAAC;AAAA,IACtD;AAEA,UAAM,KAAK,SAAS,UAAU,MAAM,WAAW,UAAU;AAAA,EAC1D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAYA,MAAM,SAAS,KAAK,KAAK,UAAU,YAAY;AAC9C,QAAI,OAAO,KAAK,aAAa,YAAY;AACxC,YAAM,IAAI,MAAM,6EAA6E,KAAK,eAAc,CAAE,KAAK;AAAA,IACxH;AAEA,UAAM,KAAK,YAAY,GAAG;AAC1B,QAAI,CAAC,UAAU;AACd,YAAM,MAAM,IAAI,YAAY,GAAG;AAC/B,UAAI,QAAQ,GAAI,OAAM,IAAI,MAAM,aAAa;AAC7C,iBAAW,IAAI,MAAM,MAAM,CAAC,EAAE,MAAM,GAAG,EAAE,CAAC;AAAA,IAC3C;AACA,UAAM,WAAW,MAAM;AAEvB,UAAM,YAAY,KAAK,eAAc,MAAO;AAG5C,QAAI,YAAY;AAChB,QAAI,CAAC,aAAa,YAAY;AAC7B,UAAI;AACH,oBAAY,MAAM,KAAK,YAAY,GAAG;AAAA,MACvC,SAAS,KAAK;AACb,gBAAQ,KAAK,4BAA4B,GAAG;AAC5C,oBAAY;AAAA,MACb;AAAA,IACD;AAGA,UAAM,oBAAoB,aACvB,CAAC,QAAQ,qBAAqB;AAC9B,YAAM,QAAQ,YAAY,mBAAmB;AAC7C,YAAM,UAAU,QAAQ,KAAK,IAAI,IAAI,KAAK,MAAO,SAAS,QAAS,GAAG,CAAC,IAAI;AAC3E,iBAAW,EAAE,QAAQ,OAAO,QAAO,CAAE;AAAA,IACtC,IACC;AAEH,QAAI;AACH,aAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAEvC,aAAK;AAAA,UACJ;AAAA,UACA;AAAA,UACA,MAAM,QAAQ,IAAI;AAAA,UAClB,SAAO;AACN,oBAAQ,KAAK,uBAAuB,GAAG,MAAM,IAAI,OAAO,EAAE;AAC1D,mBAAO,KAAK;AAAA,UACb;AAAA,UACA;AAAA;AAAA,UACA;AAAA,QACL;AAAA,MACG,CAAC;AAAA,IACF,SAAS,GAAG;AAEX,cAAQ,KAAK,uBAAuB,GAAG,MAAM,EAAE,OAAO,EAAE;AACxD,aAAO;AAAA,IACR;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,iBAAiB,MAAM,MAAM,SAAS;AACrC,UAAM,EAAE,QAAQ,OAAO,QAAO,IAAK;AACnC,QAAI,YAAY,MAAM;AACrB,UAAI,aAAa,kBAAmB,SAAQ,IAAI,SAAS,IAAI,KAAK,OAAO,GAAG;AAC5E,oBAAc,UAAU,SAAS,IAAI,KAAK,OAAO,KAAK,KAAM,YAAY,OAAO;AAAA,IAChF,OAAO;AACN,UAAI,aAAa,mBAAmB;AACnC,gBAAQ,IAAI,UAAU,IAAI,KAAK,MAAM,QAAQ;AAAA,MAC9C;AACA,oBAAc,UAAU,UAAU,IAAI,KAAK,KAAK,MAAM,SAAS,IAAI,CAAC,OAAO,KAAM,YAAY,OAAO;AAAA,IACrG;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,MAAM,YAAY,KAAK;AACtB,QAAI,KAAK,eAAc,MAAO,QAAQ;AACrC,cAAQ,KAAK,kDAAkD,KAAK,eAAc,CAAE,cAAc;AAClG,aAAO;AAAA,IACR;AACA,WAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvC,YAAM,WAAW,IAAI,WAAW,OAAO,IAAI,QAAQ,OAAO,IAAI,QAAQ,MAAM;AAC5E,YAAM,MAAM,SAAS,QAAQ,KAAK,EAAE,QAAQ,QAAQ,SAAS,EAAE,cAAc,cAAa,EAAE,GAAI,SAAO;AACtG,cAAM,MAAM,IAAI,QAAQ,gBAAgB;AACxC,gBAAQ,MAAM,SAAS,KAAK,EAAE,IAAI,IAAI;AAAA,MACvC,CAAC;AACD,UAAI,GAAG,SAAS,MAAM;AACtB,UAAI,IAAG;AAAA,IACR,CAAC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASA,MAAM,UAAU,MAAM,OAAO,OAAO;AACnC,WAAO,KAAK,YAAY,IAAI;AAC5B,QAAI,SAAS,QAAQ;AACpB,aAAQ,MAAM,KAAK,SAAS,UAAU,IAAI,IAAK;AAAA,IAChD,WAAW,SAAS,UAAU;AAC7B,aAAQ,MAAM,KAAK,SAAS,SAAS,IAAI,IAAK;AAAA,IAC/C,OAAO;AACN,aAAQ,MAAM,KAAK,SAAS,UAAU,IAAI,IAAK,KAAM,MAAM,KAAK,SAAS,SAAS,IAAI,IAAK;AAAA,IAC5F;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,MAAM,aAAa,MAAM;AACxB,WAAO,KAAK,YAAY,IAAI;AAC5B,WAAO,MAAM,KAAK,SAAS,UAAU,IAAI;AAAA,EAC1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAqBA,MAAM,YAAY,MAAM,OAAO,GAAG;AACjC,WAAO,KAAK,YAAY,IAAI;AAE5B,QAAI;AACH,YAAM,CAAC,SAAS,KAAK,IAAI,MAAM,KAAK,SAAS,YAAY,IAAI;AAE7D,YAAM,WAAW,MAAM,IAAI,WAAS;AAAA,QACnC;AAAA,QACA,MAAM,OAAO;AAAA,MACjB,EAAK;AAGF,YAAM,aAAa,CAAA;AAEnB,iBAAW,cAAc,SAAS;AACjC,cAAM,aAAa,OAAO;AAC1B,cAAM,CAAC,YAAY,QAAQ,IAAI,MAAM,KAAK,SAAS,YAAY,UAAU;AAEzE,cAAM,cAAc,SAAS,IAAI,WAAS;AAAA,UACzC;AAAA,UACA,MAAM,aAAa,MAAM;AAAA,QAC9B,EAAM;AAGF,cAAM,YAAY;AAAA,UACjB,MAAM;AAAA,UACN,MAAM;AAAA,UACN,OAAO;AAAA,UACP,SAAS,CAAA;AAAA,QACd;AACI,cAAM,UAAU,MAAM,KAAK,YAAY,YAAY,OAAO,CAAC;AAC3D,YAAI,OAAO,GAAG;AACb,gBAAMA,WAAU,MAAM,KAAK,YAAY,KAAK,MAAM,YAAY,OAAO,CAAC;AACtE,oBAAU,UAAUA,SAAQ;AAAA,QAC7B;AAEA,mBAAW,KAAK,SAAS;AAAA,MAC1B;AAEA,aAAO,EAAE,OAAO,UAAU,SAAS,WAAU;AAAA,IAC9C,SAAS,GAAG;AAEX,cAAQ,KAAK,8CAA8C,IAAI,MAAM,EAAE,OAAO,EAAE;AAChF,aAAO,EAAE,OAAO,CAAA,GAAI,SAAS,CAAA,EAAE;AAAA,IAChC;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,MAAM,SAAS,MAAM;AACpB,WAAO,KAAK,YAAY,IAAI;AAE5B,UAAM,OAAO,KAAK,iBAAiB,IAAI;AACvC,QAAI,CAAC,QAAQ,KAAK,EAAE,SAAS,IAAI,GAAG;AACnC,YAAM,SAAS,MAAM,KAAK,SAAS,eAAe,IAAI;AACtD,aAAO,QAAQ,SAAS,KAAK,MAAM,MAAM,IAAI;AAAA,IAC9C;AACA,WAAO,MAAM,KAAK,SAAS,SAAS,IAAI;AAAA,EACzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,iBAAiB,MAAM;AACtB,UAAM,QAAQ,KAAK,YAAY,GAAG;AAClC,QAAI,SAAS,IAAI;AAChB,cAAQ,KAAK,IAAI,IAAI,yBAAyB;AAC9C,aAAO;AAAA,IACR;AACA,WAAO,KAAK,MAAM,QAAQ,CAAC;AAAA,EAC5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,gBAAgB,KAAK,MAAM,MAAM;AAChC,WAAO,KAAK,YAAY,IAAI;AAC5B,QAAI;AACH,YAAM,aAAa,KAAK,UAAU,KAAK,MAAM,CAAC;AAC9C,aAAO,KAAK,SAAS,UAAU,YAAY,MAAM,IAAI;AAAA,IACtD,SAAS,OAAO;AACf,aAAO,QAAQ,OAAO,IAAI,MAAM,uCAAuC,KAAK,EAAE,CAAC;AAAA,IAChF;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQA,UAAU,KAAK;AACd,UAAM,QAAQ,IAAI,YAAY,GAAG;AACjC,QAAI,SAAS,IAAI;AAChB,aAAO;AAAA,IACR;AACA,WAAO,IAAI,MAAM,GAAG,KAAK;AAAA,EAC1B;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,QAAQ,MAAM;AACb,WAAO,KAAK,YAAY,IAAI;AAC5B,UAAM,OAAO,SAAS,cAAc,MAAM;AAC1C,SAAK,MAAM;AACX,SAAK,OAAO;AACZ,aAAS,KAAK,YAAY,IAAI;AAAA,EAC/B;AAAA;AAAA;AAAA;AAAA,EAKA,MAAM,cAAc;AACnB,UAAM,EAAE,MAAK,IAAK,MAAM,KAAK,YAAY,MAAM;AAC/C,UAAM,SAAS,CAAA;AACf,UAAM,QAAQ,UAAQ;AACrB,UAAI,KAAK,KAAK,SAAS,MAAM,GAAG;AAC/B,aAAK,QAAQ,KAAK,IAAI;AACtB,eAAO,KAAK,KAAK,IAAI;AAAA,MACtB;AAAA,IACD,CAAC;AAED,QAAI,aAAa,kBAAmB,SAAQ,IAAI,yCAAyC,OAAO,KAAK,IAAI,CAAC,EAAE;AAAA,EAC7G;AACD;AAEY,MAAC,eAAe,IAAI,aAAY;AAE5C,SAAS;AAAA,EACR,MAAM;AAAA,EACN,IAAI,MAAM;AAET,WAAO,eAAe;AAAA,EACvB;AACD,CAAC;AAED,OAAO,SAAS,SAAS,QAAQ,YAAY;"}