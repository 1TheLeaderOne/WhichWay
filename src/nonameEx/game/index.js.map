{"version":3,"file":"index.js","sources":["../../../../../../../packages/extension/WhichWay/src/nonameEx/game/index.js"],"sourcesContent":["import { lib, game, ui, get, ai, _status, Game } from \"noname\";\n\nexport class GameExt extends Game {\n\t/**\n\t * 获得所有连接牌\n\t * @returns { Card[] | Array }\n\t */\n\tgetConnectCards(){\n\t\treturn _status.sxrmConnectCards || [];\n\t}\n\n\t/**\n\t * 刷新连接标记\n\t */\n\trefreshMark() {\n\t\t//@ts-ignore\n\t\tgame.filterPlayer(current => {\n            //@ts-ignore\n\t\t\tif (current.getCards(\"h\",card=>card.isConnect()).length) {\n\t\t\t\tcurrent.markSkill(\"_sxrm_connect\");\n\t\t\t} else {\n\t\t\t\tcurrent.unmarkSkill(\"_sxrm_connect\");\n\t\t\t}\n\t\t});\n\t}\n\n\n\t/**\n\t * 统计所有玩家身上指定标记的数量总和\n\t *\n\t * 该函数会遍历所有玩家（或包括死亡玩家），根据过滤条件统计指定标记名称的总数量。\n\t *k0\n\t * @param {string} name - 要统计的标记名称\n\t * @param {Function} [filter=()=>true] - 过滤函数，用于筛选需要统计的玩家，默认为全部玩家\n\t * @param {boolean} [includeDeath=false] - 是否包含死亡玩家，默认不包含\n\t * @returns {number} 返回所有符合条件的玩家身上的标记总数\n\t *\n\t * @example\n\t * // 统计所有玩家身上的\"sha\"标记总数\n\t * const totalShaMarks = game.countMark(\"sha\");\n\t *\n\t * @example\n\t * // 统计存活玩家中，与当前玩家同阵营的\"tao\"标记总数\n\t * const sameGroupTaoMarks = game.countMark(\"tao\", (player) => player.group === _status.event.player.group);\n\t *\n\t * @example\n\t * // 统计所有玩家（包括死亡玩家）身上的\"fire\"标记总数\n\t * const totalFireMarks = game.countMark(\"fire\", ()=>true, true);\n\t */\n\tcountMark(name,filter,includeDeath = false){\n\t\tlet num = 0;\n\t\tlet players = includeDeath ? game.players.concat(game.dead) : game.players;\n\t\tif(typeof filter !== \"function\") filter = ()=>true;\n\t\tfor(let char of players){\n\t\t\tif(filter(char)){\n\t\t\t\tnum += char.countMark(name);\n\t\t\t}\n\t\t}\n\t\treturn num;\n\t}\n\n\t/**\n\t * @param { string } name\n\t * @param {*} info\n\t * @param { { translate: string, config: { [key: string]: object } } } info2\n\t */\n\taddModeSJZX(name, info, info2) {\n\t\tlib.config.all.mode.push(name);\n\t\tlib.translate[name] = info2.translate;\n\t\tlet imgsrc;\n\t\t//@ts-ignore\n\t\tlet extname = _status.extension || info2.extension;\n\t\tif (info.splash) {\n\t\t\timgsrc = info.splash;\n\t\t} else {\n\t\t\t//@ts-ignore\n\t\t\tif (_status.evaluatingExtension) {\n\t\t\t\timgsrc =\n\t\t\t\t\t\"extension-\" +\n\t\t\t\t\textname +\n\t\t\t\t\t\":image/mode/backgroud/\" +\n\t\t\t\t\tname +\n\t\t\t\t\t\".jpg\";\n\t\t\t} else {\n\t\t\t\timgsrc =\n\t\t\t\t\t\"ext:\" + extname + \"/image/mode/backgroud/\" + name + \".jpg\";\n\t\t\t}\n\t\t}\n\t\tlib.mode[name] = {\n\t\t\tname: info2.translate,\n\t\t\tconfig: info2.config,\n\t\t\tsplash: imgsrc,\n\t\t\tfromextension: true,\n\t\t};\n\t\tlib.init[\"setMode_\" + name] = async () => {\n\t\t\tawait game.import(\"mode\", (lib, game, ui, get, ai, _status) => {\n\t\t\t\tinfo.name = name;\n\t\t\t\treturn info;\n\t\t\t});\n\t\t};\n\t\tif (!lib.config.extensionInfo[extname]) {\n\t\t\tlib.config.extensionInfo[extname] = {};\n\t\t}\n\t\tif (!lib.config.extensionInfo[extname].mode) {\n\t\t\tlib.config.extensionInfo[extname].mode = [];\n\t\t}\n\t\tif (lib.config.extensionInfo[extname].mode.indexOf(name) == -1) {\n\t\t\tlib.config.extensionInfo[extname].mode.push(name);\n\t\t}\n\t\tgame.saveConfig(\"extensionMode\", lib.config.extensionInfo);\n\t}\n\n\ttotalmark(str) {\n\t\tlet num = 0;\n\t\tfor (let i = 0; i < game.players.length; i++) {\n\t\t\tif (game.players[i].hasMark(str))\n\t\t\t\tnum += game.players[i].countMark(str);\n\t\t}\n\t\treturn num;\n\t}\n\n\tshushuRDbet(min, max) {\n\t\tlet mid = (min + max) / 2;\n\t\tlet prob = Math.random();\n\t\tif (prob < 0.8) {\n\t\t\treturn Math.floor(Math.random() * (max - mid + 1)) + mid;\n\t\t} else {\n\t\t\treturn Math.floor(Math.random() * (mid - min + 1)) + min;\n\t\t}\n\t}\n\n\tRDNbet(min, max) {\n\t\tlet rand = 0;\n\t\tfor (let i = 0; i < 6; i += 1) {\n\t\t\trand += Math.random();\n\t\t}\n\t\trand = rand / 6;\n\t\treturn Math.floor(rand * (max - min + 1) + min);\n\t}\n\n\tRDbet(min, max) {\n\t\treturn Math.floor(Math.random() * (max - min + 1) + min);\n\t}\n\n\tmostStr(arr) {\n\t\tlet sortedArr = arr.slice().sort();\n\t\tlet maxCount = 0;\n\t\tlet maxStrings = [];\n\t\tlet currentCount = 1;\n\t\tlet currentString = sortedArr[0];\n\t\tfor (let i = 1; i <= sortedArr.length; i++) {\n\t\t\tif (i < sortedArr.length && sortedArr[i] === currentString) {\n\t\t\t\tcurrentCount++;\n\t\t\t} else {\n\t\t\t\tif (currentCount >= maxCount) {\n\t\t\t\t\tif (currentCount > maxCount) {\n\t\t\t\t\t\tmaxStrings = [];\n\t\t\t\t\t}\n\t\t\t\t\tmaxCount = currentCount;\n\t\t\t\t\tmaxStrings.push(currentString);\n\t\t\t\t}\n\t\t\t\tif (i < sortedArr.length) {\n\t\t\t\t\tcurrentString = sortedArr[i];\n\t\t\t\t\tcurrentCount = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn maxStrings;\n\t}\n\n\tgetGlobalmark(str) {\n\t\tvar num = 0;\n\t\tfor (var i = 0; i < game.players.length; i++) {\n\t\t\tvar players = game.players[i];\n\t\t\tif (players.hasMark(str)) num += players.countMark(str);\n\t\t}\n\t\treturn num;\n\t}\n}"],"names":["lib","game","_status"],"mappings":"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"}