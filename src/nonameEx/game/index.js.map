{"version":3,"file":"index.js","sources":["../../../../../../../packages/extension/WhichWay/src/nonameEx/game/index.js"],"sourcesContent":["import { lib, game, ui, get, ai, _status, Game } from \"noname\";\r\n\r\nexport class GameExt extends Game {\r\n\t/**\r\n\t * 获得所有连接牌\r\n\t * @returns { Card[] | Array }\r\n\t */\r\n\tgetConnectCards(){\r\n\t\treturn _status.sxrmConnectCards || [];\r\n\t}\r\n\r\n\t/**\r\n\t * 刷新连接标记\r\n\t */\r\n\trefreshMark() {\r\n\t\t//@ts-ignore\r\n\t\tgame.filterPlayer(current => {\r\n            //@ts-ignore\r\n\t\t\tif (current.getCards(\"h\",card=>card.isConnect()).length) {\r\n\t\t\t\tcurrent.markSkill(\"_sxrm_connect\");\r\n\t\t\t} else {\r\n\t\t\t\tcurrent.unmarkSkill(\"_sxrm_connect\");\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * 统计所有玩家身上指定标记的数量总和\r\n\t *\r\n\t * 该函数会遍历所有玩家（或包括死亡玩家），根据过滤条件统计指定标记名称的总数量。\r\n\t *k0\r\n\t * @param {string} name - 要统计的标记名称\r\n\t * @param {Function} [filter=()=>true] - 过滤函数，用于筛选需要统计的玩家，默认为全部玩家\r\n\t * @param {boolean} [includeDeath=false] - 是否包含死亡玩家，默认不包含\r\n\t * @returns {number} 返回所有符合条件的玩家身上的标记总数\r\n\t *\r\n\t * @example\r\n\t * // 统计所有玩家身上的\"sha\"标记总数\r\n\t * const totalShaMarks = game.countMark(\"sha\");\r\n\t *\r\n\t * @example\r\n\t * // 统计存活玩家中，与当前玩家同阵营的\"tao\"标记总数\r\n\t * const sameGroupTaoMarks = game.countMark(\"tao\", (player) => player.group === _status.event.player.group);\r\n\t *\r\n\t * @example\r\n\t * // 统计所有玩家（包括死亡玩家）身上的\"fire\"标记总数\r\n\t * const totalFireMarks = game.countMark(\"fire\", ()=>true, true);\r\n\t */\r\n\tcountMark(name,filter,includeDeath = false){\r\n\t\tlet num = 0;\r\n\t\tlet players = includeDeath ? game.players.concat(game.dead) : game.players;\r\n\t\tif(typeof filter !== \"function\") filter = ()=>true;\r\n\t\tfor(let char of players){\r\n\t\t\tif(filter(char)){\r\n\t\t\t\tnum += char.countMark(name);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn num;\r\n\t}\r\n\r\n\t/**\r\n\t * @param { string } name\r\n\t * @param {*} info\r\n\t * @param { { translate: string, config: { [key: string]: object } } } info2\r\n\t */\r\n\taddModeSJZX(name, info, info2) {\r\n\t\tlib.config.all.mode.push(name);\r\n\t\tlib.translate[name] = info2.translate;\r\n\t\tlet imgsrc;\r\n\t\t//@ts-ignore\r\n\t\tlet extname = _status.extension || info2.extension;\r\n\t\tif (info.splash) {\r\n\t\t\timgsrc = info.splash;\r\n\t\t} else {\r\n\t\t\t//@ts-ignore\r\n\t\t\tif (_status.evaluatingExtension) {\r\n\t\t\t\timgsrc =\r\n\t\t\t\t\t\"extension-\" +\r\n\t\t\t\t\textname +\r\n\t\t\t\t\t\":image/mode/backgroud/\" +\r\n\t\t\t\t\tname +\r\n\t\t\t\t\t\".jpg\";\r\n\t\t\t} else {\r\n\t\t\t\timgsrc =\r\n\t\t\t\t\t\"ext:\" + extname + \"/image/mode/backgroud/\" + name + \".jpg\";\r\n\t\t\t}\r\n\t\t}\r\n\t\tlib.mode[name] = {\r\n\t\t\tname: info2.translate,\r\n\t\t\tconfig: info2.config,\r\n\t\t\tsplash: imgsrc,\r\n\t\t\tfromextension: true,\r\n\t\t};\r\n\t\tlib.init[\"setMode_\" + name] = async () => {\r\n\t\t\tawait game.import(\"mode\", (lib, game, ui, get, ai, _status) => {\r\n\t\t\t\tinfo.name = name;\r\n\t\t\t\treturn info;\r\n\t\t\t});\r\n\t\t};\r\n\t\tif (!lib.config.extensionInfo[extname]) {\r\n\t\t\tlib.config.extensionInfo[extname] = {};\r\n\t\t}\r\n\t\tif (!lib.config.extensionInfo[extname].mode) {\r\n\t\t\tlib.config.extensionInfo[extname].mode = [];\r\n\t\t}\r\n\t\tif (lib.config.extensionInfo[extname].mode.indexOf(name) == -1) {\r\n\t\t\tlib.config.extensionInfo[extname].mode.push(name);\r\n\t\t}\r\n\t\tgame.saveConfig(\"extensionMode\", lib.config.extensionInfo);\r\n\t}\r\n\r\n\ttotalmark(str) {\r\n\t\tlet num = 0;\r\n\t\tfor (let i = 0; i < game.players.length; i++) {\r\n\t\t\tif (game.players[i].hasMark(str))\r\n\t\t\t\tnum += game.players[i].countMark(str);\r\n\t\t}\r\n\t\treturn num;\r\n\t}\r\n\r\n\tshushuRDbet(min, max) {\r\n\t\tlet mid = (min + max) / 2;\r\n\t\tlet prob = Math.random();\r\n\t\tif (prob < 0.8) {\r\n\t\t\treturn Math.floor(Math.random() * (max - mid + 1)) + mid;\r\n\t\t} else {\r\n\t\t\treturn Math.floor(Math.random() * (mid - min + 1)) + min;\r\n\t\t}\r\n\t}\r\n\r\n\tRDNbet(min, max) {\r\n\t\tlet rand = 0;\r\n\t\tfor (let i = 0; i < 6; i += 1) {\r\n\t\t\trand += Math.random();\r\n\t\t}\r\n\t\trand = rand / 6;\r\n\t\treturn Math.floor(rand * (max - min + 1) + min);\r\n\t}\r\n\r\n\tRDbet(min, max) {\r\n\t\treturn Math.floor(Math.random() * (max - min + 1) + min);\r\n\t}\r\n\r\n\tmostStr(arr) {\r\n\t\tlet sortedArr = arr.slice().sort();\r\n\t\tlet maxCount = 0;\r\n\t\tlet maxStrings = [];\r\n\t\tlet currentCount = 1;\r\n\t\tlet currentString = sortedArr[0];\r\n\t\tfor (let i = 1; i <= sortedArr.length; i++) {\r\n\t\t\tif (i < sortedArr.length && sortedArr[i] === currentString) {\r\n\t\t\t\tcurrentCount++;\r\n\t\t\t} else {\r\n\t\t\t\tif (currentCount >= maxCount) {\r\n\t\t\t\t\tif (currentCount > maxCount) {\r\n\t\t\t\t\t\tmaxStrings = [];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmaxCount = currentCount;\r\n\t\t\t\t\tmaxStrings.push(currentString);\r\n\t\t\t\t}\r\n\t\t\t\tif (i < sortedArr.length) {\r\n\t\t\t\t\tcurrentString = sortedArr[i];\r\n\t\t\t\t\tcurrentCount = 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn maxStrings;\r\n\t}\r\n\r\n\tgetGlobalmark(str) {\r\n\t\tvar num = 0;\r\n\t\tfor (var i = 0; i < game.players.length; i++) {\r\n\t\t\tvar players = game.players[i];\r\n\t\t\tif (players.hasMark(str)) num += players.countMark(str);\r\n\t\t}\r\n\t\treturn num;\r\n\t}\r\n}"],"names":["lib","game","_status"],"mappings":"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"}