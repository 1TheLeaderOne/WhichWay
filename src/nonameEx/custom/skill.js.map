{"version":3,"file":"skill.js","sources":["../../../../../../../packages/extension/WhichWay/src/nonameEx/custom/skill.ts"],"sourcesContent":["import { whichWayUtil } from \"../../utill.js\";\r\nimport { lib, game, ui, get, ai, _status, Game, Get } from \"noname\";\r\n\r\nconst skillSave = window.whichWaySave.customFucSave.skill;\r\n\r\nclass SkillCustomFunc {\r\n\t/**\r\n\t * 使一些卡牌在使用吉占时隐藏花色和数字\r\n\t * @param { Card } card\r\n\t * @param { Player } player\r\n\t *\r\n\t * @returns { Card }\r\n\t */\r\n\tinvisableJiZhan(card: Card, player: Player): Card {\r\n\t\tlet el = whichWayUtil.config(\"enable\", \"十周年UI\") ? card.querySelector(\".suit-num\") : card.querySelector(\".info\");\r\n\r\n\t\tif (el) el.classList.add(\"fuckJiZhan\");\r\n\t\telse card.classList.add(\"fuckJiZhan\"); //保底，找不到就都别看了\r\n\r\n\t\t//代理技能组，用于检查是否有吉占\r\n\t\tif (!skillSave.eventStackIsProxy) {\r\n\t\t\tskillSave.eventStackIsProxy = true;\r\n\t\t\t_status.eventManager.eventStack = new Proxy(_status.eventManager.eventStack, {\r\n\t\t\t\tset(t, p, v, r) {\r\n\t\t\t\t\t//@ts-ignore\r\n\t\t\t\t\tlet event: GameEvent = t[t.length - 1];\r\n\t\t\t\t\tif (!event) {\r\n\t\t\t\t\t\treturn Reflect.set(t, p, v, r);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tlet evt = event.getParent(\"oljizhan\")!;\r\n\t\t\t\t\tlet tag = `${player.playerid}_oljizhan`;\r\n\t\t\t\t\tif (Object.keys(evt).length > 0 && !skillSave.hiddenCardInJiZhan.includes(tag)) {\r\n\t\t\t\t\t\tskillSave.hiddenCard.add(tag);\r\n\t\t\t\t\t\twhichWayUtil.setCSSVariable(\"--SJZX-fuckJiZhan\", 0);\r\n\t\t\t\t\t} else if (Object.keys(evt).length === 0 && skillSave.hiddenCardInJiZhan.includes(tag)) {\r\n\t\t\t\t\t\tskillSave.hiddenCard.remove(tag);\r\n\t\t\t\t\t\twhichWayUtil.setCSSVariable(\"--SJZX-fuckJiZhan\", 1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//加个保底\r\n\t\t\t\t\treturn Reflect.set(t, p, v, r);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn card;\r\n\t}\r\n\r\n\t/**\r\n\t * 获取技能音频文件的路径\r\n\t *\r\n\t * 该函数用于构建指定技能的音频文件路径。如果技能不存在，则会输出警告并返回 undefined。\r\n\t * 音频路径基于技能的 logAudio 或 audio 属性生成，并可选择性地附加数字后缀。\r\n\t *\r\n\t * @param {string} skill - 技能名称，用于查找对应的音频资源\r\n\t * @param {number|number[]} [num] - 可选的音频文件编号，用于指定具体哪一个音频文件（如 skill1.mp3, skill2.mp3）\r\n\t *                                  如果传入数组，则会返回多个音频路径\r\n\t * @returns {string|string[]|undefined} 返回音频文件路径:\r\n\t *                                      - 如果没有提供 num 参数，返回基础路径字符串\r\n\t *                                      - 如果提供了 num 参数，返回对应音频文件路径的数组\r\n\t *                                      - 如果技能不存在则返回 undefined\r\n\t *\r\n\t */\r\n\tgetSkillAudioPath(skill:string, num?:number|number[]):string|string[]|undefined {\r\n\t\tif (!lib.skill[skill]) {\r\n\t\t\tconsole.warn(`技能${skill}不存在`);\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tif (!Array.isArray(num) && num !== void 0) num = [num];\r\n\t\tlet path = lib.skill[skill].logAudio ? lib.skill[skill].logAudio() : lib.skill[skill].audio;\r\n\t\tpath = path.replace(path.slice(-2), \"\");\r\n\t\t//@ts-ignore\r\n\t\treturn num ? num.map(i => path + `/${skill}${i}.mp3`) : path;\r\n\t}\r\n\r\n\t/**\r\n\t * 定义 setter 和 getter\r\n\t * @param {object} target - 目标对象。\r\n\t *\r\n\t * @param {object} target - 目标对象。\r\n\t * @param {string | string[]} prop - 属性名或属性名数组。\r\n\t * @param {(() => any) | (() => any)[]=} get - getter 函数或函数数组。\r\n\t * @param {((value: any) => void) | ((value: any) => void)[]=} set - setter 函数或函数数组。\r\n\t */\r\n\tdefineAccessor(target, prop, get, set) {\r\n\t\tconst hasValidGet = typeof get === \"function\" || (Array.isArray(get) && get.some(fn => typeof fn === \"function\"));\r\n\t\tconst hasValidSet = typeof set === \"function\" || (Array.isArray(set) && set.some(fn => typeof fn === \"function\"));\r\n\r\n\t\tif (!hasValidGet && !hasValidSet) {\r\n\t\t\tthrow new Error(\"get 和 set 至少有一个是 function!\");\r\n\t\t}\r\n\t\tif (Array.isArray(prop)) {\r\n\t\t\tfor (let i = 0; i < prop.length; i++) {\r\n\t\t\t\tlet g = get?.[i] || get?.[0] || get;\r\n\t\t\t\tlet s = set?.[i] || set?.[0] || set;\r\n\t\t\t\tthis.defineAccessor(target, prop[i], g, s);\r\n\t\t\t}\r\n\t\t}\r\n\t\t//@ts-ignore\r\n\t\tObject.defineProperty(target, prop, {\r\n\t\t\tget: typeof get === \"function\" ? get : undefined,\r\n\t\t\tset: typeof set === \"function\" ? set : undefined,\r\n\t\t\tenumerable: true,\r\n\t\t\tconfigurable: true,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport const skillCustomFunc = new SkillCustomFunc();\r\n"],"names":["get"],"mappings":";;AAGA,MAAM,YAAY,OAAO,aAAa,cAAc;AAEpD,MAAM,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQrB,gBAAgB,MAAY,QAAsB;AACjD,QAAI,KAAK,aAAa,OAAO,UAAU,OAAO,IAAI,KAAK,cAAc,WAAW,IAAI,KAAK,cAAc,OAAO;AAE9G,QAAI,GAAI,IAAG,UAAU,IAAI,YAAY;AAAA,QAChC,MAAK,UAAU,IAAI,YAAY;AAGpC,QAAI,CAAC,UAAU,mBAAmB;AACjC,gBAAU,oBAAoB;AAC9B,cAAQ,aAAa,aAAa,IAAI,MAAM,QAAQ,aAAa,YAAY;AAAA,QAC5E,IAAI,GAAG,GAAG,GAAG,GAAG;AAEf,cAAI,QAAmB,EAAE,EAAE,SAAS,CAAC;AACrC,cAAI,CAAC,OAAO;AACX,mBAAO,QAAQ,IAAI,GAAG,GAAG,GAAG,CAAC;AAAA,UAC9B;AAEA,cAAI,MAAM,MAAM,UAAU,UAAU;AACpC,cAAI,MAAM,GAAG,OAAO,QAAQ;AAC5B,cAAI,OAAO,KAAK,GAAG,EAAE,SAAS,KAAK,CAAC,UAAU,mBAAmB,SAAS,GAAG,GAAG;AAC/E,sBAAU,WAAW,IAAI,GAAG;AAC5B,yBAAa,eAAe,qBAAqB,CAAC;AAAA,UACnD,WAAW,OAAO,KAAK,GAAG,EAAE,WAAW,KAAK,UAAU,mBAAmB,SAAS,GAAG,GAAG;AACvF,sBAAU,WAAW,OAAO,GAAG;AAC/B,yBAAa,eAAe,qBAAqB,CAAC;AAAA,UACnD;AAGA,iBAAO,QAAQ,IAAI,GAAG,GAAG,GAAG,CAAC;AAAA,QAC9B;AAAA,MAAA,CACA;AAAA,IACF;AAEA,WAAO;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAiBA,kBAAkB,OAAc,KAAgD;AAC/E,QAAI,CAAC,IAAI,MAAM,KAAK,GAAG;AACtB,cAAQ,KAAK,KAAK,KAAK,KAAK;AAC5B,aAAO;AAAA,IACR;AACA,QAAI,CAAC,MAAM,QAAQ,GAAG,KAAK,QAAQ,OAAQ,OAAM,CAAC,GAAG;AACrD,QAAI,OAAO,IAAI,MAAM,KAAK,EAAE,WAAW,IAAI,MAAM,KAAK,EAAE,SAAA,IAAa,IAAI,MAAM,KAAK,EAAE;AACtF,WAAO,KAAK,QAAQ,KAAK,MAAM,EAAE,GAAG,EAAE;AAEtC,WAAO,MAAM,IAAI,IAAI,CAAA,MAAK,OAAO,IAAI,KAAK,GAAG,CAAC,MAAM,IAAI;AAAA,EACzD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWA,eAAe,QAAQ,MAAMA,MAAK,KAAK;AACtC,UAAM,cAAc,OAAOA,SAAQ,cAAe,MAAM,QAAQA,IAAG,KAAKA,KAAI,KAAK,CAAA,OAAM,OAAO,OAAO,UAAU;AAC/G,UAAM,cAAc,OAAO,QAAQ,cAAe,MAAM,QAAQ,GAAG,KAAK,IAAI,KAAK,CAAA,OAAM,OAAO,OAAO,UAAU;AAE/G,QAAI,CAAC,eAAe,CAAC,aAAa;AACjC,YAAM,IAAI,MAAM,4BAA4B;AAAA,IAC7C;AACA,QAAI,MAAM,QAAQ,IAAI,GAAG;AACxB,eAAS,IAAI,GAAG,IAAI,KAAK,QAAQ,KAAK;AACrC,YAAI,IAAIA,OAAM,CAAC,KAAKA,OAAM,CAAC,KAAKA;AAChC,YAAI,IAAI,MAAM,CAAC,KAAK,MAAM,CAAC,KAAK;AAChC,aAAK,eAAe,QAAQ,KAAK,CAAC,GAAG,GAAG,CAAC;AAAA,MAC1C;AAAA,IACD;AAEA,WAAO,eAAe,QAAQ,MAAM;AAAA,MACnC,KAAK,OAAOA,SAAQ,aAAaA,OAAM;AAAA,MACvC,KAAK,OAAO,QAAQ,aAAa,MAAM;AAAA,MACvC,YAAY;AAAA,MACZ,cAAc;AAAA,IAAA,CACd;AAAA,EACF;AACD;AAEO,MAAM,kBAAkB,IAAI,gBAAA;"}