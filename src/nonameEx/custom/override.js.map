{"version":3,"file":"override.js","sources":["../../../../../../../packages/extension/WhichWay/src/nonameEx/custom/override.js"],"sourcesContent":["import { lib, game, ui, get, ai, _status, Game, Get } from \"noname\";\r\nimport { whichWayAPIOverride } from \"../../override/index.js\";\r\n\r\n/**\r\n * 修改酒\r\n * 用于技能：调酒\r\n */\r\nwhichWayAPIOverride.overrideAPI(\"lib.skill.jiu\", {\r\n\ttrigger: {\r\n\t\tplayer: \"useCard1\",\r\n\t},\r\n\tfilter: function (event, player) {\r\n\t\tif (player.hasSkill(\"tiaojiumrfz\")) {\r\n\t\t\treturn event.card && (get.type(event.card) == \"trick\" || get.type(event.card) == \"basic\") && event.card.name != \"jiu\";\r\n\t\t}\r\n\t\treturn event.card && event.card.name == \"sha\";\r\n\t},\r\n\tforced: true,\r\n\tcharlotte: true,\r\n\tfirstDo: true,\r\n\tcontent: function () {\r\n\t\t/**@ts-ignore */\r\n\t\tif (!player.hasSkill(\"tiaojiumrfz\")) {\r\n\t\t\t/**@ts-ignore */\r\n\t\t\tif (!trigger.baseDamage) trigger.baseDamage = 1;\r\n\t\t\t/**@ts-ignore */\r\n\t\t\ttrigger.baseDamage += player.storage.jiu;\r\n\t\t} else {\r\n\t\t\t/**@ts-ignore */\r\n\t\t\ttrigger.effectCount += player.storage.jiu;\r\n\t\t}\r\n\t\t/**@ts-ignore */\r\n\t\ttrigger.jiu = true;\r\n\t\t/**@ts-ignore */\r\n\t\ttrigger.jiu_add = player.storage.jiu;\r\n\t\t/**@ts-ignore */\r\n\t\tgame.addVideo(\"jiuNode\", player, false);\r\n\t\t/**@ts-ignore */\r\n\t\tgame.broadcastAll(function (player) {\r\n\t\t\tplayer.removeSkill(\"jiu\");\r\n\t\t\t/**@ts-ignore */\r\n\t\t}, player);\r\n\t},\r\n\ttemp: true,\r\n\tvanish: true,\r\n\tsilent: true,\r\n\tpopup: false,\r\n\tnopop: true,\r\n\tonremove: function (player) {\r\n\t\tif (player.node.jiu) {\r\n\t\t\tplayer.node.jiu.delete();\r\n\t\t\tplayer.node.jiu2.delete();\r\n\t\t\tdelete player.node.jiu;\r\n\t\t\tdelete player.node.jiu2;\r\n\t\t}\r\n\t\tdelete player.storage.jiu;\r\n\t},\r\n\tai: {\r\n\t\tdamageBonus: true,\r\n\t\tskillTagFilter: function (player, tag, arg) {\r\n\t\t\tif (tag === \"damageBonus\") return arg && arg.card && arg.card.name === \"sha\" && !player.hasSkill(\"tiaojiumrfz\");\r\n\t\t},\r\n\t},\r\n\tgroup: \"jiu2\",\r\n});\r\nwhichWayAPIOverride.overrideAPI(\"lib.skill.jiu2.filter\", function (event, player) {\r\n\tif (player.hasSkillTag(\"jiuSustain\", null, event.name)) return false;\r\n\tif (event.name == \"useCard\") {\r\n\t\tif (player.hasSkill(\"tiaojiumrfz\")) {\r\n\t\t\treturn event.card && (get.type(event.card) == \"trick\" || get.type(event.card) == \"basic\") && event.card.name != \"jiu\";\r\n\t\t}\r\n\t\treturn event.card && event.card.name == \"sha\";\r\n\t}\r\n\treturn true;\r\n});\r\n\r\n// 将兵临城下模式的【兵临城下】添加到lib.card中\r\nif (!lib.card.binglinchengxia) {\r\n\tlib.card[\"binglinchengxia\"] = {\r\n\t\tfullskin: true,\r\n\t\timage: \"ext:WhichWay/image/card/binglinchengxia.webp\",\r\n\t\ttype: \"delay\",\r\n\t\tfilterTarget: function (card, player, target) {\r\n\t\t\treturn lib.filter.judge(card, player, target) && player != target;\r\n\t\t},\r\n\t\tjudge: function (card) {\r\n\t\t\tif (get.suit(card) == \"diamond\") return 0;\r\n\t\t\treturn -3;\r\n\t\t},\r\n\t\teffect: function () {\r\n\t\t\t\"step 0\";\r\n\t\t\t// @ts-ignore\r\n\t\t\tif (result.bool == false) {\r\n\t\t\t\tif (\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t!player.countCards(\"e\", function (card) {\r\n\t\t\t\t\t\treturn lib.filter.cardDiscardable(\r\n\t\t\t\t\t\t\tcard,\r\n\t\t\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t\t\tplayer,\r\n\t\t\t\t\t\t\t\"shuiyanqijuny\"\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t})\r\n\t\t\t\t) {\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tplayer.damage(\"nosource\");\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tevent.finish();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} else\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tplayer.chooseControl(\"discard_card\", \"take_damage\", function (event, player) {\r\n\t\t\t\t\t\tif (get.damageEffect(player, event.player, player) >= 0) {\r\n\t\t\t\t\t\t\treturn \"take_damage\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (player.hp >= 3 && player.countCards(\"e\") >= 2) {\r\n\t\t\t\t\t\t\treturn \"take_damage\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn \"discard_card\";\r\n\t\t\t\t\t});\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t} else event.finish();\r\n\t\t\t\"step 1\";\r\n\t\t\t// @ts-ignore\r\n\t\t\tif (result.control == \"discard_card\") {\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\tplayer.discard(\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tplayer.getCards(\"e\", function (card) {\r\n\t\t\t\t\t\treturn lib.filter.cardDiscardable(\r\n\t\t\t\t\t\t\tcard,\r\n\t\t\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\t\t\tplayer,\r\n\t\t\t\t\t\t\t\"shuiyanqijuny\"\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t} else player.damage(\"nosource\");\r\n\t\t},\r\n\t\tai: {\r\n\t\t\torder: 1,\r\n\t\t\tvalue: 3,\r\n\t\t\tuseful: 2,\r\n\t\t\ttag: {\r\n\t\t\t\tdamage: 1,\r\n\t\t\t\tloseCard: 1,\r\n\t\t\t},\r\n\t\t\tresult: {\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\ttarget: function (player, target, card, isLink) {\r\n\t\t\t\t\tvar es = target.getCards(\"e\");\r\n\t\t\t\t\tif (!es.length) return -1.5;\r\n\t\t\t\t\tvar val = 0;\r\n\t\t\t\t\tfor (var i of es) val += get.value(i, target);\r\n\t\t\t\t\treturn -Math.min(1.5, val / 5);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t},\r\n\t};\r\n\tlib.translate[\"binglinchengxia\"] = \"兵临城下\";\r\n\tlib.translate[\"binglinchengxia_info\"] = \"出牌阶段，对一名其他角色使用。将此牌横置于目标角色的判定区内。目标角色于判定阶段进行判定，若判定结果不为♦，则其弃置装备区内的所有牌或受到1点伤害。\";\r\n}\r\n\r\n//特蕾西娅&特雷西斯技能初始化\r\nlet duplicateSkills = [\"chenke1mrfz\", \"chenke2mrfz\", \"chenke3mrfz\"];\r\nlet targetSkill = get.info(\"chenkemrfz\");\r\nfor (let skill of duplicateSkills) {\r\n\tlib.translate[skill] = lib.translate[\"chenkemrfz\"];\r\n\tlib.translate[skill + \"_info\"] = lib.translate[\"chenkemrfz_info\"];\r\n\tlib.skill[skill] = {\r\n\t\t...targetSkill,\r\n\t\taudio: skill === \"chenke3mrfz\" ? \"chenkemrfz\" : false,\r\n\t};\r\n}"],"names":["event","player"],"mappings":"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"}