{"version":3,"file":"index.js","sources":["../../../../../../packages/extension/WhichWay/src/toast/index.ts"],"sourcesContent":["import { onContent, onSetDev } from \"../hooks/index.js\";\r\n\r\ntype ToastPosition = \"topLeft\" | \"topRight\" | \"bottomLeft\" | \"bottomRight\" | \"bottomCenter\";\r\n\r\ninterface ToastData {\r\n\tid: string | symbol;\r\n\ttoast: HTMLDivElement;\r\n\ttimeout: number | null;\r\n}\r\n\r\nconst TOAST_POSITIONS: ToastPosition[] = [\"topLeft\", \"topRight\", \"bottomLeft\", \"bottomRight\", \"bottomCenter\"];\r\n\r\nclass ToastManager {\r\n\ttoastRegistry: ToastRegistry;\r\n\r\n\tconstructor() {\r\n\t\tthis.toastRegistry = this._initRegistry();\r\n\t}\r\n\r\n\tprivate _initRegistry(): ToastRegistry {\r\n\t\tconst registry = {\r\n\t\t\ttopLeft: [] as ToastData[],\r\n\t\t\ttopRight: [] as ToastData[],\r\n\t\t\tbottomLeft: [] as ToastData[],\r\n\t\t\tbottomRight: [] as ToastData[],\r\n\t\t\tbottomCenter: [] as ToastData[],\r\n\t\t} satisfies Record<ToastPosition, ToastData[]>;\r\n\r\n\t\t// 添加 get 方法\r\n\t\t(registry as ToastRegistry).get = (id: string | symbol): ToastData | null => {\r\n\t\t\tfor (const pos of TOAST_POSITIONS) {\r\n\t\t\t\tconst found = registry[pos].find(t => t.id === id);\r\n\t\t\t\tif (found) return found;\r\n\t\t\t}\r\n\t\t\treturn null;\r\n\t\t};\r\n\r\n\t\treturn registry as ToastRegistry;\r\n\t}\r\n\r\n\t/**\r\n\t * 显示一个浮动提示（Toast）\r\n\t *\r\n\t * @param message - 提示内容\r\n\t * @param duration - 显示时长（毫秒）或 true 表示永久\r\n\t * @param position - 位置\r\n\t * @param id - 唯一标识符（string 或 Symbol）\r\n\t * @returns 关闭函数\r\n\t */\r\n\tshowToast(message: string, duration: number | boolean = 3000, position: ToastPosition = \"bottomCenter\", id?: string | symbol): () => void {\r\n\t\tconst positionPresets: Record<ToastPosition, Partial<CSSStyleDeclaration>> = {\r\n\t\t\ttopLeft: { top: \"80px\", left: \"20px\" },\r\n\t\t\ttopRight: { top: \"80px\", right: \"20px\" },\r\n\t\t\tbottomLeft: { bottom: \"20px\", left: \"20px\" },\r\n\t\t\tbottomRight: { bottom: \"20px\", right: \"20px\" },\r\n\t\t\tbottomCenter: {\r\n\t\t\t\tbottom: \"20px\",\r\n\t\t\t\tleft: \"50%\",\r\n\t\t\t\ttransform: \"translateX(-50%)\",\r\n\t\t\t},\r\n\t\t};\r\n\r\n\t\tconst validPosition = Object.hasOwn(positionPresets, position) ? position : (\"bottomCenter\" as const);\r\n\r\n\t\tconst baseStyle = positionPresets[validPosition];\r\n\r\n\t\tconst toastId = id ?? this._generateRandomId();\r\n\r\n\t\t// 警告：特定前缀 ID 的使用（仅对 string 类型）\r\n\t\tif (typeof toastId === \"string\" && toastId.startsWith(\"dragging_\") && !message.includes(\"骨骼\")) {\r\n\t\t\tconsole.warn(`${toastId} 以 dragging_ 开头，在关闭动皮拖拽时会被删除！`);\r\n\t\t}\r\n\r\n\t\tconst existing = this.toastRegistry.get(toastId);\r\n\t\tif (existing) {\r\n\t\t\texisting.toast.innerHTML = message;\r\n\t\t\tif (existing.timeout !== null) {\r\n\t\t\t\tclearTimeout(existing.timeout);\r\n\t\t\t}\r\n\r\n\t\t\tlet newTimeout: number | null = null;\r\n\t\t\tif (duration !== true) {\r\n\t\t\t\tnewTimeout = window.setTimeout(() => {\r\n\t\t\t\t\tthis._removeToast(validPosition, toastId, existing.toast);\r\n\t\t\t\t}, duration as number);\r\n\t\t\t}\r\n\r\n\t\t\texisting.timeout = newTimeout;\r\n\r\n\t\t\treturn () => {\r\n\t\t\t\tif (existing.timeout !== null) {\r\n\t\t\t\t\tclearTimeout(existing.timeout);\r\n\t\t\t\t}\r\n\t\t\t\tthis._removeToast(validPosition, toastId, existing.toast);\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// 创建新 toast\r\n\t\tconst toast = document.createElement(\"div\");\r\n\t\ttoast.className = \"toastSJZX\";\r\n\t\ttoast.id = `toastSJZX-${String(toastId)}`;\r\n\t\ttoast.innerHTML = message;\r\n\r\n\t\t// 应用基础样式\r\n\t\tObject.assign(toast.style, baseStyle);\r\n\t\ttoast.style.visibility = \"visible\";\r\n\t\ttoast.style.opacity = \"1\";\r\n\r\n\t\t// 计算偏移\r\n\t\tconst currentList = this.toastRegistry[validPosition];\r\n\t\tconst spacing = 60;\r\n\r\n\t\tif (validPosition.startsWith(\"top\")) {\r\n\t\t\ttoast.style.top = `${80 + currentList.length * spacing}px`;\r\n\t\t\ttoast.style.bottom = \"\"; // 清除 bottom\r\n\t\t} else {\r\n\t\t\ttoast.style.bottom = `${20 + currentList.length * spacing}px`;\r\n\t\t\ttoast.style.top = \"\"; // 清除 top\r\n\t\t}\r\n\r\n\t\tdocument.body.appendChild(toast);\r\n\r\n\t\tconst newToastData: ToastData = { id: toastId, toast, timeout: null };\r\n\t\tcurrentList.push(newToastData);\r\n\r\n\t\tif (duration !== true) {\r\n\t\t\tnewToastData.timeout = window.setTimeout(() => {\r\n\t\t\t\tthis._removeToast(validPosition, toastId, toast);\r\n\t\t\t}, duration as number);\r\n\t\t}\r\n\r\n\t\treturn () => {\r\n\t\t\tif (newToastData.timeout !== null) {\r\n\t\t\t\tclearTimeout(newToastData.timeout);\r\n\t\t\t}\r\n\t\t\tthis._removeToast(validPosition, toastId, toast);\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * 通过唯一 ID 移除指定的 Toast\r\n\t * @param id - Toast 的唯一标识符（string 或 symbol）\r\n\t * @returns 是否成功移除\r\n\t */\r\n\tremoveToastById(id: string | symbol): boolean {\r\n\t\tfor (const position of TOAST_POSITIONS) {\r\n\t\t\tconst list = this.toastRegistry[position];\r\n\t\t\tconst index = list.findIndex(t => t.id === id);\r\n\t\t\tif (index !== -1) {\r\n\t\t\t\tconst toastData = list[index];\r\n\t\t\t\tthis._removeToast(position, id, toastData.toast);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate _generateRandomId(): string {\r\n\t\treturn Math.floor(Math.random() * 1e9).toString(36);\r\n\t}\r\n\r\n\tprivate _removeToast(position: ToastPosition, toastId: string | symbol, toastElement: HTMLDivElement): void {\r\n\t\ttoastElement.style.opacity = \"0\";\r\n\t\ttoastElement.style.visibility = \"hidden\";\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (toastElement.parentNode) {\r\n\t\t\t\ttoastElement.remove();\r\n\t\t\t}\r\n\t\t}, 500);\r\n\r\n\t\t// 从注册表中移除\r\n\t\tthis.toastRegistry[position] = this.toastRegistry[position].filter(t => t.id !== toastId);\r\n\r\n\t\t// 重新排列\r\n\t\tthis._repositionToasts(position);\r\n\t}\r\n\r\n\tprivate _repositionToasts(position: ToastPosition): void {\r\n\t\tconst list = this.toastRegistry[position];\r\n\t\tconst spacing = 60;\r\n\r\n\t\tlist.forEach((item, index) => {\r\n\t\t\tif (position.startsWith(\"top\")) {\r\n\t\t\t\titem.toast.style.top = `${80 + index * spacing}px`;\r\n\t\t\t\titem.toast.style.bottom = \"\";\r\n\t\t\t} else {\r\n\t\t\t\titem.toast.style.bottom = `${20 + index * spacing}px`;\r\n\t\t\t\titem.toast.style.top = \"\";\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n\r\ninterface ToastRegistry extends Record<ToastPosition, ToastData[]> {\r\n\tget(id: string | symbol): ToastData | null;\r\n}\r\n\r\nexport const whichWayToast = new ToastManager();\r\n\r\nonSetDev({\r\n\tname: \"whichWayToast_dev\",\r\n\tfn: () => {\r\n\t\t//@ts-ignore\r\n\t\twindow.whichWayToast = whichWayToast;\r\n\t},\r\n});\r\n\r\nonContent({\r\n\tname: \"whichWayToast_register\",\r\n\tfn:()=>{\r\n\t\twindow.whichWay.register(\"toast\", whichWayToast);\r\n\t}\r\n})\r\n"],"names":[],"mappings":"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"}