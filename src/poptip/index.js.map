{"version":3,"file":"index.js","sources":["../../../../../../packages/extension/WhichWay/src/poptip/index.js"],"sourcesContent":["import { lib, game, ui, get, ai, _status } from \"noname\";\r\nimport { onArenaReady, onPrecontent, onSetDev } from \"../hooks/index.js\";\r\nimport { WhichWayPopTipsConfig } from \"./poptip.js\";\r\n\r\nclass WhichWayPoptip {\r\n\tconstructor() {\r\n\t\t//注册预设的poptip\r\n\t\tthis.registerPopTip(WhichWayPopTipsConfig);\r\n\r\n\t\t//初始化驶舰之向技能的poptip\r\n\t\tonArenaReady({\r\n\t\t\tname:\"WhichWayPoptip_init\",\r\n\t\t\tfn:()=>{\r\n\t\t\t\tthis.compilePopTipTranslate(window.whichWaySave.allSkills);\r\n\t\t\t},\r\n\t\t\tpriority:10000,\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * 注册过的popTip\r\n\t */\r\n\tpopTips = {};\r\n\r\n\t/**\r\n\t * 编译popTip，会将derivation内的技能标注出来\r\n\t * @param {object | Array<string>} skills - 技能对象\r\n\t * @returns {void}\r\n\t */\r\n\tcompilePopTipTranslate(skills) {\r\n\t\tif(Array.isArray(skills)){\r\n\t\t\tskills = skills.reduce((obj, name) => {\r\n\t\t\t\tobj[name] = lib.skill[name];\r\n\t\t\t\treturn obj;\r\n\t\t\t}, {});\r\n\t\t}\r\n\t\tfor (let name in skills) {\r\n\t\t\tlet info = skills[name];\r\n\t\t\tif (info.derivation) {\r\n\t\t\t\tlet derivations = Array.isArray(info.derivation) ? info.derivation : [info.derivation];\r\n\t\t\t\tfor (let maySkill of derivations) {\r\n\t\t\t\t\tif (lib.translate[maySkill]) {\r\n\t\t\t\t\t\tlet infoTrans = `${name}_info`;\r\n\t\t\t\t\t\tif (lib.translate[infoTrans] && lib.translate[infoTrans].includes(get.translation(maySkill))) {\r\n\t\t\t\t\t\t\tlet cnMaySkill = get.translation(maySkill);\r\n\t\t\t\t\t\t\tlet index = lib.translate[infoTrans].indexOf(cnMaySkill) - 1;\r\n\t\t\t\t\t\t\tlet splicing = \"\";\r\n\t\t\t\t\t\t\tfor (let i = 0; i < cnMaySkill.length + 2; i++) {\r\n\t\t\t\t\t\t\t\tsplicing += lib.translate[infoTrans][index + i];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tlib.translate[infoTrans] = lib.translate[infoTrans].replaceAll(splicing, get.poptip(maySkill));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * 注册poptip\r\n\t * @param {Record<string,WhichWayPopTipConfig>} popTips\r\n\t * @returns {void}\r\n\t */\r\n\tregisterPopTip(popTips) {\r\n\t\tlet popTipList = [];\r\n\r\n\t\tfor (let name in popTips) {\r\n\t\t\tif (name in this.popTips) {\r\n\t\t\t\tconsole.warn(`popTip ${name} 已存在`);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tlet info = popTips[name];\r\n\t\t\tif (!info.id) info.id = `sjzx_${name}`;\r\n\t\t\tif (!info.name) info.name = name;\r\n\t\t\tif (!info.info) info.info = `无详细信息`;\r\n\r\n\t\t\tif (!Array.isArray(info.info)) info.info = [info.info];\r\n\t\t\tif (info.trim !== void 0 && info.trim !== false) {\r\n\t\t\t\tif (info.trim === true) info.info[0] = `『${info.info[0]}』`;\r\n\t\t\t\telse if (typeof info.trim === \"number\" || Array.isArray(info.trim)) {\r\n\t\t\t\t\tinfo.trim = Array.isArray(info.trim) ? info.trim : [info.trim];\r\n\t\t\t\t\tfor (let i = 0; i < info.info.length; i++) {\r\n\t\t\t\t\t\tif (info.trim.includes(i)) info.info[i] = `『${info.info[i]}』`;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tinfo.info = info.info.join(\"<br>\");\r\n\r\n\t\t\tif (!info.sourceInfo) info.info = `${info.info}<br><font color=\"red\">来自驶舰之向</font>`;\r\n\t\t\telse info.info = `${info.info}<br><font color=\"red\">来自${info.sourceInfo}</font>`;\r\n\r\n\t\t\tpopTipList.push(info);\r\n\r\n\t\t\tthis.popTips[name] = info;\r\n\t\t}\r\n\r\n\t\tif (popTipList.length > 0) {\r\n\t\t\t//@ts-ignore\r\n\t\t\tpopTipList.forEach(i => lib.poptip.add(i));\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport const whichWayPoptip = new WhichWayPoptip();\r\n\r\nonSetDev({\r\n\tname: \"whichWayPoptip_dev\",\r\n\tfn: () => {\r\n\t\t//@ts-ignore\r\n\t\twindow.whichWayPoptip = whichWayPoptip;\r\n\t},\r\n\tpriority: 0,\r\n});\r\n\r\nwindow.whichWay.register(\"poptip\", whichWayPoptip)"],"names":[],"mappings":";;;AAIA,MAAM,eAAe;AAAA,EACpB,cAAc;AAEb,SAAK,eAAe,qBAAqB;AAGzC,iBAAa;AAAA,MACZ,MAAK;AAAA,MACL,IAAG,MAAI;AACN,aAAK,uBAAuB,OAAO,aAAa,SAAS;AAAA,MAC1D;AAAA,MACA,UAAS;AAAA,IACZ,CAAG;AAAA,EACF;AAAA;AAAA;AAAA;AAAA,EAKA,UAAU,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOV,uBAAuB,QAAQ;AAC9B,QAAG,MAAM,QAAQ,MAAM,GAAE;AACxB,eAAS,OAAO,OAAO,CAAC,KAAK,SAAS;AACrC,YAAI,IAAI,IAAI,IAAI,MAAM,IAAI;AAC1B,eAAO;AAAA,MACR,GAAG,CAAA,CAAE;AAAA,IACN;AACA,aAAS,QAAQ,QAAQ;AACxB,UAAI,OAAO,OAAO,IAAI;AACtB,UAAI,KAAK,YAAY;AACpB,YAAI,cAAc,MAAM,QAAQ,KAAK,UAAU,IAAI,KAAK,aAAa,CAAC,KAAK,UAAU;AACrF,iBAAS,YAAY,aAAa;AACjC,cAAI,IAAI,UAAU,QAAQ,GAAG;AAC5B,gBAAI,YAAY,GAAG,IAAI;AACvB,gBAAI,IAAI,UAAU,SAAS,KAAK,IAAI,UAAU,SAAS,EAAE,SAAS,IAAI,YAAY,QAAQ,CAAC,GAAG;AAC7F,kBAAI,aAAa,IAAI,YAAY,QAAQ;AACzC,kBAAI,QAAQ,IAAI,UAAU,SAAS,EAAE,QAAQ,UAAU,IAAI;AAC3D,kBAAI,WAAW;AACf,uBAAS,IAAI,GAAG,IAAI,WAAW,SAAS,GAAG,KAAK;AAC/C,4BAAY,IAAI,UAAU,SAAS,EAAE,QAAQ,CAAC;AAAA,cAC/C;AACA,kBAAI,UAAU,SAAS,IAAI,IAAI,UAAU,SAAS,EAAE,WAAW,UAAU,IAAI,OAAO,QAAQ,CAAC;AAAA,YAC9F;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,eAAe,SAAS;AACvB,QAAI,aAAa,CAAA;AAEjB,aAAS,QAAQ,SAAS;AACzB,UAAI,QAAQ,KAAK,SAAS;AACzB,gBAAQ,KAAK,UAAU,IAAI,MAAM;AACjC;AAAA,MACD;AAEA,UAAI,OAAO,QAAQ,IAAI;AACvB,UAAI,CAAC,KAAK,GAAI,MAAK,KAAK,QAAQ,IAAI;AACpC,UAAI,CAAC,KAAK,KAAM,MAAK,OAAO;AAC5B,UAAI,CAAC,KAAK,KAAM,MAAK,OAAO;AAE5B,UAAI,CAAC,MAAM,QAAQ,KAAK,IAAI,EAAG,MAAK,OAAO,CAAC,KAAK,IAAI;AACrD,UAAI,KAAK,SAAS,UAAU,KAAK,SAAS,OAAO;AAChD,YAAI,KAAK,SAAS,KAAM,MAAK,KAAK,CAAC,IAAI,IAAI,KAAK,KAAK,CAAC,CAAC;AAAA,iBAC9C,OAAO,KAAK,SAAS,YAAY,MAAM,QAAQ,KAAK,IAAI,GAAG;AACnE,eAAK,OAAO,MAAM,QAAQ,KAAK,IAAI,IAAI,KAAK,OAAO,CAAC,KAAK,IAAI;AAC7D,mBAAS,IAAI,GAAG,IAAI,KAAK,KAAK,QAAQ,KAAK;AAC1C,gBAAI,KAAK,KAAK,SAAS,CAAC,EAAG,MAAK,KAAK,CAAC,IAAI,IAAI,KAAK,KAAK,CAAC,CAAC;AAAA,UAC3D;AAAA,QACD;AAAA,MACD;AACA,WAAK,OAAO,KAAK,KAAK,KAAK,MAAM;AAEjC,UAAI,CAAC,KAAK,WAAY,MAAK,OAAO,GAAG,KAAK,IAAI;AAAA,UACzC,MAAK,OAAO,GAAG,KAAK,IAAI,2BAA2B,KAAK,UAAU;AAEvE,iBAAW,KAAK,IAAI;AAEpB,WAAK,QAAQ,IAAI,IAAI;AAAA,IACtB;AAEA,QAAI,WAAW,SAAS,GAAG;AAE1B,iBAAW,QAAQ,OAAK,IAAI,OAAO,IAAI,CAAC,CAAC;AAAA,IAC1C;AAAA,EACD;AACD;AAEY,MAAC,iBAAiB,IAAI,eAAc;AAEhD,SAAS;AAAA,EACR,MAAM;AAAA,EACN,IAAI,MAAM;AAET,WAAO,iBAAiB;AAAA,EACzB;AAAA,EACA,UAAU;AACX,CAAC;AAED,OAAO,SAAS,SAAS,UAAU,cAAc;"}